<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HairSalon Pro - Professional Hairdresser Management</title>
    <meta name="description" content="Complete hairdresser salon management system">
    <meta name="theme-color" content="#e91e63">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HairSalon Pro">
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <style>
        /* All your existing CSS remains the same */
        :root {
            --primary: #e91e63;
            --primary-dark: #c2185b;
            --primary-light: #f8bbd9;
            --secondary: #9c27b0;
            --accent: #ff9800;
            --dark: #0d1117;
            --darker: #010409;
            --dark-gray: #161b22;
            --light: #f5f5f5;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --border-radius: 16px;
            --shadow: 0 12px 40px rgba(0,0,0,0.4);
            --transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        /* Light Mode Theme */
        body.light-mode {
            --dark: #ffffff;
            --darker: #f5f5f5;
            --dark-gray: #e0e0e0;
            --light: #212121;
            --shadow: 0 12px 40px rgba(0,0,0,0.1);
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            color: #212121;
        }
        
        body.light-mode .card {
            background: linear-gradient(135deg, #ffffff 0%, #fafafa 100%);
            border: 1px solid rgba(0,0,0,0.08);
        }
        
        body.light-mode .sidebar {
            background: linear-gradient(180deg, #ffffff 0%, #f5f5f5 100%);
            border-right: 1px solid #e0e0e0;
        }
        
        body.light-mode .app-header {
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        body.light-mode .form-control {
            background: #ffffff;
            border: 1px solid #bdbdbd;
            color: #212121;
        }
        
        body.light-mode .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
        }
        
        body.light-mode .nav-link {
            color: #212121;
        }
        
        body.light-mode .nav-link:hover,
        body.light-mode .nav-link.active {
            background: linear-gradient(90deg, rgba(233, 30, 99, 0.1) 0%, transparent 100%);
        }
        
        body.light-mode .data-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(240,240,240,0.6) 100%);
        }
        
        body.light-mode .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
        }
        
        body.light-mode .calendar-day {
            background: rgba(0,0,0,0.03);
        }
        
        body.light-mode .calendar-day:hover {
            background: rgba(0,0,0,0.05);
        }
        
        body.light-mode .modal-content {
            background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        body.light-mode input[type="time"]::-webkit-calendar-picker-indicator {
            filter: invert(0);
        }
        
        /* Light mode text visibility fixes */
        body.light-mode .card-title {
            color: var(--primary);
        }
        
        body.light-mode .stat-label,
        body.light-mode .form-label,
        body.light-mode .data-item-content h4,
        body.light-mode .data-item-content p,
        body.light-mode .empty-state h3,
        body.light-mode .empty-state p,
        body.light-mode select,
        body.light-mode .calendar-day-number,
        body.light-mode .pagination-info,
        body.light-mode .search-box input::placeholder {
            color: #212121;
        }
        
        body.light-mode .data-item-content p {
            color: rgba(0,0,0,0.7);
        }
        
        body.light-mode .search-box i {
            color: rgba(0,0,0,0.5);
        }
        
        body.light-mode .usage-history-info h4,
        body.light-mode .usage-history-info p {
            color: #212121;
        }
        
        body.light-mode .inventory-item-select h4,
        body.light-mode .inventory-item-select p {
            color: #212121;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--light);
            line-height: 1.7;
            min-height: 100vh;
            overflow-x: hidden;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Mobile Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--dark-gray) 0%, var(--darker) 100%);
            border-right: 1px solid #30363d;
            padding: 1rem 0;
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            box-shadow: 2px 0 20px rgba(0,0,0,0.6);
            z-index: 1000;
            transition: var(--transition);
            overflow-y: auto;
        }

        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1001;
            background: var(--primary);
            border: none;
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: var(--shadow);
        }

        .logo {
            color: var(--primary);
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 2rem;
            text-shadow: 0 0 15px rgba(233, 30, 99, 0.5);
            letter-spacing: 1.5px;
            padding: 0 1rem;
            font-weight: 700;
        }

        .logo i {
            margin-right: 10px;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section-title {
            color: var(--primary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 0 1.5rem;
            margin-bottom: 0.8rem;
            opacity: 0.7;
            font-weight: 600;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.8rem 1.5rem;
            color: var(--light);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            border-left: 4px solid transparent;
            margin: 0.1rem 0;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .nav-link:hover {
            background: linear-gradient(90deg, rgba(233, 30, 99, 0.1) 0%, transparent 100%);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .nav-link.active {
            background: linear-gradient(90deg, rgba(233, 30, 99, 0.15) 0%, transparent 100%);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .nav-link i {
            margin-right: 12px;
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        .language-selector {
            padding: 0 1.5rem;
            margin-top: auto;
            margin-bottom: 1rem;
        }

        .language-selector select {
            width: 100%;
            padding: 12px;
            background: var(--dark);
            border: 1px solid #30363d;
            border-radius: 8px;
            color: var(--light);
            font-size: 0.9rem;
        }

        /* Main Content */
        .main-content {
            flex-grow: 1;
            margin-left: 280px;
            padding: 15px;
            transition: var(--transition);
            width: calc(100% - 280px);
        }

        /* Header */
        .app-header {
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-gray) 100%);
            padding: 20px;
            text-align: center;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            overflow: hidden;
        }

        .app-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }

        .tagline {
            color: var(--primary-light);
            font-size: 1em;
            opacity: 0.9;
            margin-bottom: 15px;
            font-weight: 300;
        }

        /* Install Button */
        .install-btn {
            background: linear-gradient(135deg, var(--success) 0%, #66bb6a 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: none;
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
            min-height: 44px;
            min-width: 44px;
            position: relative;
            overflow: hidden;
            font-size: 0.9rem;
        }

        .install-btn.pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .install-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.4);
        }

        /* Sections */
        .section {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Cards */
        .card {
            background: linear-gradient(135deg, var(--dark-gray) 0%, #2d2d2d 100%);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.08);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: var(--transition);
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
            flex-wrap: wrap;
            gap: 10px;
        }

        .card-title {
            font-size: 1.3em;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }

        /* Buttons */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            position: relative;
            overflow: hidden;
            min-height: 44px;
            min-width: 44px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(233, 30, 99, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 10px 30px rgba(233, 30, 99, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #66bb6a 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #ef5350 100%);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 10px 18px;
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        /* Small Action Buttons */
        .btn-sm {
            padding: 8px 12px;
            font-size: 0.8em;
            min-height: 36px;
            min-width: 36px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-gray) 100%);
            padding: 20px;
            text-align: center;
            border-radius: var(--border-radius);
            border-left: 5px solid var(--primary);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: var(--shadow);
            border-left-color: var(--secondary);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
            line-height: 1;
            text-shadow: 0 4px 15px rgba(233, 30, 99, 0.3);
        }

        .stat-label {
            color: var(--light);
            opacity: 0.9;
            font-size: 0.85em;
            font-weight: 600;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255,255,255,0.6);
        }

        .empty-state i {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.4;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 4px 15px rgba(0,0,0,0.3));
        }

        .empty-state h3 {
            font-size: 1.4em;
            margin-bottom: 10px;
            color: rgba(255,255,255,0.8);
            font-weight: 600;
        }

        .empty-state p {
            font-size: 0.9em;
            margin-bottom: 20px;
            opacity: 0.8;
            line-height: 1.6;
        }

        /* Toast & Install Prompt */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--success) 0%, #66bb6a 100%);
            color: white;
            padding: 14px 20px;
            border-radius: var(--border-radius);
            z-index: 1001;
            display: none;
            box-shadow: var(--shadow);
            animation: toastSlideUp 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-weight: 600;
            backdrop-filter: blur(10px);
            max-width: 90%;
            text-align: center;
            font-size: 0.9rem;
        }

        .toast.show {
            display: block;
        }

        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 1000;
            display: none;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 90%;
            animation: toastSlideUp 0.4s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .install-prompt.show {
            display: flex;
        }

        @keyframes toastSlideUp {
            from {
                bottom: -60px;
                opacity: 0;
            }
            to {
                bottom: 20px;
                opacity: 1;
            }
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.show {
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-gray) 100%);
            border-radius: var(--border-radius);
            padding: 25px;
            width: 100%;
            max-width: 500px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.1);
            animation: modalSlideUp 0.4s ease;
            position: relative;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
        }

        .modal-title {
            font-size: 1.3em;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.3em;
            cursor: pointer;
            transition: var(--transition);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            background: rgba(255,255,255,0.1);
            color: var(--primary);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            color: var(--light);
            font-weight: 600;
            font-size: 0.9em;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            background: var(--dark);
            border: 1px solid #30363d;
            border-radius: 8px;
            color: var(--light);
            font-size: 1em;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.2);
        }
        
        /* Search Box */
        .search-box {
            position: relative;
            margin-bottom: 15px;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 12px 12px 40px;
            background: var(--dark);
            border: 1px solid #30363d;
            border-radius: 8px;
            color: var(--light);
            font-size: 1em;
            transition: var(--transition);
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.2);
        }
        
        .search-box i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255,255,255,0.5);
        }
        
        /* Category Tabs */
        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: var(--border-radius);
        }
        
        .category-tab {
            padding: 10px 18px;
            background: rgba(255,255,255,0.08);
            border: 2px solid transparent;
            border-radius: 8px;
            color: var(--light);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
            min-height: 44px;
        }
        
        .category-tab:hover {
            background: rgba(255,255,255,0.12);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .category-tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 6px 20px rgba(233, 30, 99, 0.3);
        }
        
        body.light-mode .category-tabs {
            background: rgba(0,0,0,0.05);
        }
        
        body.light-mode .category-tab {
            background: rgba(0,0,0,0.08);
            color: #212121;
        }
        
        body.light-mode .category-tab:hover {
            background: rgba(0,0,0,0.12);
        }
        
        body.light-mode .category-tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }
        
        /* Offline Indicator */
        .offline-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--warning) 0%, #ffa726 100%);
            color: white;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 1001;
            display: none;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            animation: slideInRight 0.4s ease;
        }
        
        .offline-indicator.show {
            display: flex;
        }
        
        @keyframes slideInRight {
            from {
                right: -300px;
                opacity: 0;
            }
            to {
                right: 20px;
                opacity: 1;
            }
        }
        
        /* Update Notification */
        .update-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
            color: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            z-index: 1001;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 90%;
            animation: slideInDown 0.4s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        @keyframes slideInDown {
            from {
                top: -100px;
                opacity: 0;
            }
            to {
                top: 20px;
                opacity: 1;
            }
        }
        
        /* Confirmation Dialog */
        .confirm-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, var(--dark) 0%, var(--dark-gray) 100%);
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 2001;
            max-width: 400px;
            width: 90%;
            display: none;
            flex-direction: column;
            gap: 20px;
        }
        
        .confirm-dialog.show {
            display: flex;
            animation: modalSlideUp 0.4s ease;
        }
        
        .confirm-dialog h3 {
            color: var(--primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .confirm-dialog p {
            color: var(--light);
            margin: 0;
            line-height: 1.6;
        }
        
        .confirm-dialog-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        /* Focus visible for better keyboard navigation */
        *:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        /* Screen reader only class for accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Undo toast styling */
        .toast.undo-toast {
            display: flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, var(--warning) 0%, #ffa726 100%);
        }
        
        .toast.undo-toast .undo-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85em;
            transition: var(--transition);
        }
        
        .toast.undo-toast .undo-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 15px;
        }
        
        .pagination button {
            min-width: 44px;
            min-height: 44px;
        }
        
        .pagination-info {
            color: var(--light);
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* FIXED: Time input styling */
        input[type="time"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        input[type="time"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
            cursor: pointer;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Data Lists */
        .data-list {
            display: grid;
            gap: 12px;
        }

        .data-item {
            background: linear-gradient(135deg, rgba(42,42,42,0.8) 0%, rgba(50,50,50,0.6) 100%);
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .data-item.appointment-item {
            border-left: 4px solid var(--secondary);
        }
        
        .data-item.inventory-item {
            border-left: 4px solid var(--accent);
        }

        .data-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .data-item-content {
            flex: 1;
            min-width: 200px;
        }

        .data-item-content h4 {
            color: var(--light);
            margin-bottom: 6px;
            font-size: 1em;
        }

        .data-item-content p {
            color: rgba(255,255,255,0.7);
            font-size: 0.85em;
            margin-bottom: 4px;
        }
        
        .data-item-content span {
            display: block;
            font-size: 0.75em;
            color: var(--primary-light);
            margin-top: 4px;
        }

        .data-item-actions {
            display: flex;
            gap: 8px;
            flex-shrink: 0;
        }
        
        /* Low Stock highlight */
        .data-item.low-stock {
            border-left-color: var(--danger);
        }

        /* Calendar Styles */
        .calendar-container {
            margin-top: 15px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .calendar-nav {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            background: rgba(255,255,255,0.05);
            border-radius: var(--border-radius);
            padding: 12px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 8px;
            color: var(--primary);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.8em;
        }

        .calendar-day {
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            padding: 8px;
            min-height: 80px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            border: 1px solid transparent;
        }

        .calendar-day:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--primary);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            background: rgba(233, 30, 99, 0.2);
            border: 1px solid var(--primary);
        }

        .calendar-day.has-events::after {
            content: '';
            position: absolute;
            top: 4px;
            right: 4px;
            width: 6px;
            height: 6px;
            background: var(--primary);
            border-radius: 50%;
        }

        .calendar-day-number {
            font-weight: bold;
            margin-bottom: 3px;
            font-size: 0.9em;
        }

        .calendar-events {
            display: flex;
            flex-direction: column;
            gap: 2px;
            max-height: 60px;
            overflow-y: auto;
        }

        .calendar-event {
            background: var(--primary);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.7em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
        }

        .calendar-event.completed {
            background: var(--success);
        }

        .calendar-event.cancelled {
            background: var(--danger);
        }

        /* Inventory Deduction Styles */
        .inventory-deduction-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .inventory-items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .inventory-item-select {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .inventory-item-select:hover {
            background: rgba(255,255,255,0.1);
        }

        .inventory-item-select.selected {
            border-color: var(--primary);
            background: rgba(233, 30, 99, 0.1);
        }

        .inventory-item-select.low-stock {
            border-color: var(--danger);
        }

        .inventory-item-select h4 {
            color: var(--light);
            margin-bottom: 4px;
            font-size: 0.9em;
        }

        .inventory-item-select p {
            color: rgba(255,255,255,0.7);
            font-size: 0.8em;
            margin-bottom: 4px;
        }

        .inventory-quantity-input {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .inventory-quantity-input input {
            width: 60px;
            padding: 6px;
            background: var(--dark);
            border: 1px solid #30363d;
            border-radius: 4px;
            color: var(--light);
            font-size: 0.8em;
        }

        /* Export Section */
        .export-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .export-option {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .export-option:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--primary);
        }

        .export-option i {
            font-size: 2em;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .export-option h4 {
            color: var(--light);
            margin-bottom: 4px;
            font-size: 0.9em;
        }

        .export-option p {
            color: rgba(255,255,255,0.7);
            font-size: 0.8em;
        }

        /* Usage History Styles */
        .usage-history {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .usage-history-item {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .usage-history-item:last-child {
            margin-bottom: 0;
        }

        .usage-history-info h4 {
            color: var(--light);
            margin-bottom: 4px;
            font-size: 0.9em;
        }

        .usage-history-info p {
            color: rgba(255,255,255,0.7);
            font-size: 0.8em;
            margin-bottom: 2px;
        }

        .usage-quantity {
            font-weight: bold;
            color: var(--danger);
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 250px;
            }
            .main-content {
                margin-left: 250px;
                width: calc(100% - 250px);
            }
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .sidebar {
                width: 280px;
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 60px 10px 10px 10px;
            }

            .logo span, .nav-link span, .nav-section-title {
                display: block;
            }

            .nav-link {
                justify-content: flex-start;
                padding: 1rem 1.5rem;
            }

            .nav-link i {
                margin-right: 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .data-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .data-item-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 4px;
            }

            .calendar-day {
                min-height: 70px;
                padding: 4px;
            }

            .calendar-event {
                font-size: 0.65em;
            }

            .inventory-items-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }

            .export-options {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 20px;
                margin: 10px;
            }

            .form-actions {
                flex-direction: column;
            }

            .form-actions .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .card {
                padding: 15px;
            }

            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 2px;
            }

            .calendar-day {
                min-height: 60px;
                padding: 2px;
            }

            .calendar-day-number {
                font-size: 0.8em;
            }

            .calendar-event {
                font-size: 0.6em;
                padding: 1px 2px;
            }

            .inventory-items-grid {
                grid-template-columns: 1fr;
            }

            .app-header {
                padding: 15px;
            }

            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .card-header .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Safe area support for newer iPhones */
        @supports(padding: max(0px)) {
            .main-content, .modal {
                padding-left: max(10px, env(safe-area-inset-left));
                padding-right: max(10px, env(safe-area-inset-right));
            }
        }
        
        /* Bottom Navigation Tabs */
        .bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, var(--dark-gray) 0%, var(--darker) 100%);
            border-top: 1px solid #30363d;
            padding: 8px 0;
            padding-bottom: max(8px, env(safe-area-inset-bottom));
            box-shadow: 0 -4px 20px rgba(0,0,0,0.6);
            z-index: 999;
        }
        
        body.light-mode .bottom-nav {
            background: linear-gradient(180deg, #ffffff 0%, #f5f5f5 100%);
            border-top: 1px solid #e0e0e0;
        }
        
        .bottom-nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 12px;
            min-width: 60px;
            min-height: 56px;
            color: rgba(255,255,255,0.6);
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
            border-radius: 12px;
            position: relative;
        }
        
        body.light-mode .bottom-nav-item {
            color: rgba(0,0,0,0.6);
        }
        
        .bottom-nav-item i {
            font-size: 1.3rem;
            margin-bottom: 4px;
        }
        
        .bottom-nav-item span {
            font-size: 0.7rem;
            font-weight: 600;
            text-align: center;
        }
        
        .bottom-nav-item.active {
            color: var(--primary);
            background: rgba(233, 30, 99, 0.1);
        }
        
        .bottom-nav-item:active {
            transform: scale(0.95);
        }
        
        @media (max-width: 768px) {
            .bottom-nav {
                display: block;
            }
            
            .main-content {
                padding-bottom: 80px;
            }
        }
    </style>
</head>
<body>
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <div class="app-container">
        <nav class="sidebar" id="sidebar">
            <div class="logo">
                <i class="fas fa-scissors"></i>
                <span data-i18n="app_name">HairSalon Pro</span>
            </div>

            <div class="nav-section">
                <div class="nav-section-title" data-i18n="main_navigation">Main Navigation</div>
                <a class="nav-link active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i> <span data-i18n="dashboard">Dashboard</span>
                </a>
                <a class="nav-link" data-section="clients">
                    <i class="fas fa-users"></i> <span data-i18n="clients">Clients</span>
                </a>
                <a class="nav-link" data-section="appointments">
                    <i class="fas fa-calendar-check"></i> <span data-i18n="appointments">Appointments</span>
                </a>
                <a class="nav-link" data-section="upcoming">
                    <i class="fas fa-clock"></i> <span data-i18n="upcoming_sessions">Upcoming Sessions</span>
                </a>
                <a class="nav-link" data-section="calendar">
                    <i class="fas fa-calendar-alt"></i> <span data-i18n="calendar">Calendar</span>
                </a>
                <a class="nav-link" data-section="inventory">
                    <i class="fas fa-boxes"></i> <span data-i18n="inventory">Inventory</span>
                </a>
                <a class="nav-link" data-section="export">
                    <i class="fas fa-file-export"></i> <span data-i18n="export_data">Export Data</span>
                </a>
                <a class="nav-link" data-section="settings">
                    <i class="fas fa-cog"></i> <span data-i18n="settings">Settings</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title" data-i18n="quick_actions">Quick Actions</div>
                <a class="nav-link" id="quickAddClient">
                    <i class="fas fa-user-plus"></i> <span data-i18n="add_client">Add Client</span>
                </a>
                <a class="nav-link" id="quickAddAppointment">
                    <i class="fas fa-calendar-plus"></i> <span data-i18n="schedule_appointment">Schedule Appointment</span>
                </a>
            </div>

            <div class="language-selector">
                <select id="languageSelect">
                    <option value="en">English</option>
                    <option value="es">Español</option>
                    <option value="ru">Русский</option>
                    <option value="he">עברית</option>
                </select>
            </div>
        </nav>

        <div class="main-content">
            <div class="app-header">
                <div class="logo">
                    <i class="fas fa-scissors"></i>
                    <span data-i18n="app_name">HairSalon Pro</span>
                </div>
                <div class="tagline" data-i18n="tagline">Professional Hairdresser Management System</div>
                <button class="install-btn" id="installButton">
                    <i class="fas fa-download"></i> <span data-i18n="install_app">Install App</span>
                </button>
            </div>

            <!-- Dashboard Section -->
            <div class="section active" id="dashboard">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-tachometer-alt"></i>
                            <span data-i18n="dashboard">Dashboard</span>
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card" onclick="HairSalonApp.showSection('clients')">
                            <div class="stat-value" id="totalClients">0</div>
                            <div class="stat-label" data-i18n="total_clients">Total Clients</div>
                        </div>
                        <div class="stat-card" onclick="HairSalonApp.showSection('appointments')">
                            <div class="stat-value" id="totalAppointments">0</div>
                            <div class="stat-label" data-i18n="total_appointments">Total Appointments</div>
                        </div>
                        <div class="stat-card" onclick="HairSalonApp.showSection('upcoming')">
                            <div class="stat-value" id="upcomingAppointments">0</div>
                            <div class="stat-label" data-i18n="upcoming_appointments">Upcoming</div>
                        </div>
                        <div class="stat-card" onclick="HairSalonApp.showSection('inventory')">
                            <div class="stat-value" id="lowStockItems">0</div>
                            <div class="stat-label" data-i18n="low_stock_items">Low Stock Items</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="monthRevenue">0</div>
                            <div class="stat-label" data-i18n="month_revenue">Month Revenue</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="yearRevenue">0</div>
                            <div class="stat-label" data-i18n="year_revenue">Year Revenue</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-clock"></i>
                            <span data-i18n="recent_appointments">Recent Appointments</span>
                        </div>
                        <button class="btn btn-primary" onclick="HairSalonApp.openModal('addAppointmentModal')">
                            <i class="fas fa-plus"></i> <span data-i18n="schedule_appointment">Schedule Appointment</span>
                        </button>
                    </div>
                    <div class="data-list" id="recentAppointmentsList">
                        <!-- Recent appointments will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Clients Section -->
            <div class="section" id="clients">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-users"></i>
                            <span data-i18n="clients">Clients</span>
                        </div>
                        <button class="btn btn-primary" onclick="HairSalonApp.openModal('addClientModal')">
                            <i class="fas fa-plus"></i> <span data-i18n="add_client">Add Client</span>
                        </button>
                    </div>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="clientSearch" data-i18n-placeholder="search_clients_placeholder" onkeyup="HairSalonApp.filterClients(this.value)">
                    </div>
                    <div class="data-list" id="clientsList">
                        <!-- Clients will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Appointments Section -->
            <div class="section" id="appointments">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-calendar-check"></i>
                            <span data-i18n="appointments">Appointments</span>
                        </div>
                        <button class="btn btn-primary" onclick="HairSalonApp.openModal('addAppointmentModal')">
                            <i class="fas fa-plus"></i> <span data-i18n="schedule_appointment">Schedule Appointment</span>
                        </button>
                    </div>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="appointmentSearch" data-i18n-placeholder="search_appointments_placeholder" onkeyup="HairSalonApp.filterAppointments(this.value)">
                    </div>
                    <div class="data-list" id="appointmentsList">
                        <!-- Appointments will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Upcoming Sessions Section -->
            <div class="section" id="upcoming">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-clock"></i>
                            <span data-i18n="upcoming_sessions">Upcoming Sessions</span>
                        </div>
                    </div>
                    <div class="data-list" id="upcomingSessionsList">
                        <!-- Upcoming sessions will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Calendar Section -->
            <div class="section" id="calendar">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-calendar-alt"></i>
                            <span data-i18n="calendar">Calendar</span>
                        </div>
                        <div class="calendar-nav">
                            <button class="btn btn-outline btn-sm" id="prevMonth">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <h3 id="currentMonthYear"></h3>
                            <button class="btn btn-outline btn-sm" id="nextMonth">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="calendar-container">
                        <div class="calendar-grid" id="calendarGrid">
                            <!-- Calendar will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Section -->
            <div class="section" id="inventory">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-boxes"></i>
                            <span data-i18n="inventory">Inventory</span>
                        </div>
                        <button class="btn btn-primary" onclick="HairSalonApp.openModal('addInventoryModal')">
                            <i class="fas fa-plus"></i> <span data-i18n="add_inventory_item">Add Inventory Item</span>
                        </button>
                    </div>
                    <div class="category-tabs" id="inventoryTabs">
                        <div class="category-tab active" data-category="all" onclick="HairSalonApp.filterInventoryByCategory('all')">
                            <i class="fas fa-th"></i>
                            <span data-i18n="all_items">All Items</span>
                        </div>
                        <div class="category-tab" data-category="hair_products" onclick="HairSalonApp.filterInventoryByCategory('hair_products')">
                            <i class="fas fa-spray-can"></i>
                            <span data-i18n="hair_products">Hair Products</span>
                        </div>
                        <div class="category-tab" data-category="styling_tools" onclick="HairSalonApp.filterInventoryByCategory('styling_tools')">
                            <i class="fas fa-tools"></i>
                            <span data-i18n="styling_tools">Styling Tools</span>
                        </div>
                        <div class="category-tab" data-category="color_products" onclick="HairSalonApp.filterInventoryByCategory('color_products')">
                            <i class="fas fa-palette"></i>
                            <span data-i18n="color_products">Color Products</span>
                        </div>
                        <div class="category-tab" data-category="accessories" onclick="HairSalonApp.filterInventoryByCategory('accessories')">
                            <i class="fas fa-gem"></i>
                            <span data-i18n="accessories">Accessories</span>
                        </div>
                        <div class="category-tab" data-category="other" onclick="HairSalonApp.filterInventoryByCategory('other')">
                            <i class="fas fa-ellipsis-h"></i>
                            <span data-i18n="other">Other</span>
                        </div>
                    </div>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="inventorySearch" data-i18n-placeholder="search_inventory_placeholder" onkeyup="HairSalonApp.filterInventory(this.value)">
                    </div>
                    <div class="data-list" id="inventoryList">
                        <!-- Inventory items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Export Data Section -->
            <div class="section" id="export">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-file-export"></i>
                            <span data-i18n="export_data">Export Data</span>
                        </div>
                    </div>
                    <div class="export-section">
                        <p data-i18n="export_description">Export your salon data for backup or analysis purposes.</p>
                        <div class="export-options">
                            <div class="export-option" onclick="HairSalonApp.exportData('clients')">
                                <i class="fas fa-users"></i>
                                <h4 data-i18n="export_clients">Export Clients</h4>
                                <p data-i18n="export_clients_desc">CSV format</p>
                            </div>
                            <div class="export-option" onclick="HairSalonApp.exportData('appointments')">
                                <i class="fas fa-calendar"></i>
                                <h4 data-i18n="export_appointments">Export Appointments</h4>
                                <p data-i18n="export_appointments_desc">CSV format</p>
                            </div>
                            <div class="export-option" onclick="HairSalonApp.exportData('inventory')">
                                <i class="fas fa-boxes"></i>
                                <h4 data-i18n="export_inventory">Export Inventory</h4>
                                <p data-i18n="export_inventory_desc">CSV format</p>
                            </div>
                            <div class="export-option" onclick="HairSalonApp.backupAllData()">
                                <i class="fas fa-download"></i>
                                <h4 data-i18n="backup_all_data">Backup All Data</h4>
                                <p data-i18n="json_format">JSON format</p>
                            </div>
                            <div class="export-option" onclick="document.getElementById('restoreFileInput').click()">
                                <i class="fas fa-upload"></i>
                                <h4 data-i18n="restore_data">Restore Data</h4>
                                <p data-i18n="from_backup_file">From backup file</p>
                            </div>
                        </div>
                        <input type="file" id="restoreFileInput" accept=".json" style="display: none;" onchange="HairSalonApp.restoreData(this.files[0])">
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="section" id="settings">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-cog"></i>
                            <span data-i18n="settings">Settings</span>
                        </div>
                    </div>
                    
                    <form id="settingsForm">
                        <div class="form-group">
                            <label class="form-label" for="settingsBusinessName" data-i18n="business_name">Business Name</label>
                            <input type="text" class="form-control" id="settingsBusinessName" data-i18n-placeholder="enter_salon_name_placeholder">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="settingsCurrency" data-i18n="currency_symbol">Currency Symbol</label>
                            <input type="text" class="form-control" id="settingsCurrency" data-i18n-placeholder="currency_placeholder" maxlength="3">
                            <small style="color: rgba(255,255,255,0.6); margin-top: 5px; display: block;" data-i18n="leave_empty_currency">Leave empty for no currency symbol</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="settingsDefaultDuration" data-i18n="default_appointment_duration">Default Appointment Duration (minutes)</label>
                            <input type="number" class="form-control" id="settingsDefaultDuration" min="15" max="480" step="15" value="60">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="settingsLowStockDefault" data-i18n="default_low_stock_threshold">Default Low Stock Threshold</label>
                            <input type="number" class="form-control" id="settingsLowStockDefault" min="0" max="100" value="5">
                            <small style="color: rgba(255,255,255,0.6); margin-top: 5px; display: block;" data-i18n="applied_new_inventory">Applied when adding new inventory items</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" data-i18n="business_hours">Business Hours</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>
                                    <label class="form-label" for="settingsOpenTime" style="font-size: 0.85em;" data-i18n="opening_time">Opening Time</label>
                                    <input type="time" class="form-control" id="settingsOpenTime" value="09:00">
                                </div>
                                <div>
                                    <label class="form-label" for="settingsCloseTime" style="font-size: 0.85em;" data-i18n="closing_time">Closing Time</label>
                                    <input type="time" class="form-control" id="settingsCloseTime" value="18:00">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" data-i18n="working_days">Working Days</label>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-top: 10px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="workingDayMon" checked style="width: 20px; height: 20px; cursor: pointer;">
                                    <span data-i18n="monday">Monday</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="workingDayTue" checked style="width: 20px; height: 20px; cursor: pointer;">
                                    <span data-i18n="tuesday">Tuesday</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="workingDayWed" checked style="width: 20px; height: 20px; cursor: pointer;">
                                    <span data-i18n="wednesday">Wednesday</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="workingDayThu" checked style="width: 20px; height: 20px; cursor: pointer;">
                                    <span data-i18n="thursday">Thursday</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="workingDayFri" checked style="width: 20px; height: 20px; cursor: pointer;">
                                    <span data-i18n="friday">Friday</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="workingDaySat" style="width: 20px; height: 20px; cursor: pointer;">
                                    <span data-i18n="saturday">Saturday</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="workingDaySun" style="width: 20px; height: 20px; cursor: pointer;">
                                    <span data-i18n="sunday">Sunday</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" data-i18n="appearance">Appearance</label>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 10px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; border: 2px solid transparent;" id="themeDarkLabel">
                                    <input type="radio" name="theme" id="themeDark" value="dark" checked style="width: 20px; height: 20px; cursor: pointer;">
                                    <span><i class="fas fa-moon"></i> <span data-i18n="dark_mode">Dark Mode</span></span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; border: 2px solid transparent;" id="themeLightLabel">
                                    <input type="radio" name="theme" id="themeLight" value="light" style="width: 20px; height: 20px; cursor: pointer;">
                                    <span><i class="fas fa-sun"></i> <span data-i18n="light_mode">Light Mode</span></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="settingsTimeFormat" data-i18n="time_format">Time Format</label>
                            <select class="form-control" id="settingsTimeFormat">
                                <option value="12" data-i18n="12_hour">12-hour (AM/PM)</option>
                                <option value="24" data-i18n="24_hour">24-hour</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="settingsDateFormat" data-i18n="date_format">Date Format</label>
                            <select class="form-control" id="settingsDateFormat">
                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" data-i18n="notifications">Notifications</label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-top: 10px;">
                                <input type="checkbox" id="settingsShowToasts" checked style="width: 20px; height: 20px; cursor: pointer;">
                                <span data-i18n="show_toast_notifications">Show toast notifications</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-top: 10px;">
                                <input type="checkbox" id="settingsEnablePushNotifications" style="width: 20px; height: 20px; cursor: pointer;">
                                <span data-i18n="enable_push_notifications">Enable push notifications for upcoming sessions</span>
                            </label>
                            <p style="font-size: 0.8em; color: rgba(255,255,255,0.6); margin-top: 5px; margin-left: 28px;" data-i18n="push_notification_info">Get notified 24 hours and 1 hour before appointments</p>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" onclick="HairSalonApp.resetSettings()">
                                <i class="fas fa-undo"></i> <span data-i18n="reset_defaults">Reset to Defaults</span>
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> <span data-i18n="save_settings">Save Settings</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Client Modal -->
    <div class="modal" id="addClientModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-user-plus"></i>
                    <span data-i18n="add_new_client">Add New Client</span>
                </div>
                <button class="close-modal" onclick="HairSalonApp.closeModal('addClientModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addClientForm" autocomplete="off">
                <div class="form-group">
                    <label class="form-label" for="clientName" data-i18n="client_name">Client Name</label>
                    <input type="text" class="form-control" id="clientName" required aria-required="true" aria-label="Client Name" data-i18n-placeholder="enter_client_name_placeholder" autocomplete="off">
                </div>
                <div class="form-group">
                    <label class="form-label" for="clientPhone" data-i18n="phone_number">Phone Number (Optional)</label>
                    <input type="tel" class="form-control" id="clientPhone" aria-label="Phone Number" data-i18n-placeholder="phone_placeholder" autocomplete="off">
                </div>
                <div class="form-group">
                    <label class="form-label" for="clientEmail" data-i18n="email_address">Email Address (Optional)</label>
                    <input type="email" class="form-control" id="clientEmail" aria-label="Email Address" data-i18n-placeholder="email_placeholder" autocomplete="off">
                </div>
                <div class="form-group">
                    <label class="form-label" for="clientNotes" data-i18n="notes">Notes (Optional)</label>
                    <textarea class="form-control" id="clientNotes" rows="3" aria-label="Notes" data-i18n-placeholder="notes_placeholder" autocomplete="off"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="HairSalonApp.closeModal('addClientModal')" data-i18n="cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="save_client">Save Client</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Appointment Modal -->
    <div class="modal" id="addAppointmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-calendar-plus"></i>
                    <span data-i18n="schedule_appointment">Schedule Appointment</span>
                </div>
                <button class="close-modal" onclick="HairSalonApp.closeModal('addAppointmentModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addAppointmentForm">
                <div class="form-group">
                    <label class="form-label" for="appointmentClient" data-i18n="select_client">Select Client (Optional)</label>
                    <select class="form-control" id="appointmentClient">
                        <option value="" data-i18n="select_client">Select Client</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="appointmentDate" data-i18n="date">Date</label>
                    <input type="date" class="form-control" id="appointmentDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="appointmentTime" data-i18n="time">Time</label>
                    <input type="time" class="form-control" id="appointmentTime" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="appointmentService" data-i18n="service">Service</label>
                    <input type="text" class="form-control" id="appointmentService" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="appointmentPrice" data-i18n="price">Price (Optional)</label>
                    <input type="number" class="form-control" id="appointmentPrice" step="0.01">
                </div>
                
                <!-- Inventory Deduction Section -->
                <div class="inventory-deduction-section">
                    <h4><i class="fas fa-box-open"></i> <span data-i18n="products_used">Products Used</span></h4>
                    <p data-i18n="select_products_used">Select products used during this appointment:</p>
                    <div class="inventory-items-grid" id="appointmentInventoryItems">
                        <!-- Inventory items will be populated here -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="appointmentNotes" data-i18n="notes">Notes</label>
                    <textarea class="form-control" id="appointmentNotes" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="HairSalonApp.closeModal('addAppointmentModal')" data-i18n="cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="save_appointment">Save Appointment</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Inventory Modal -->
    <div class="modal" id="addInventoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-box-plus"></i>
                    <span data-i18n="add_inventory_item">Add Inventory Item</span>
                </div>
                <button class="close-modal" onclick="HairSalonApp.closeModal('addInventoryModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addInventoryForm">
                <div class="form-group">
                    <label class="form-label" for="inventoryName" data-i18n="item_name">Item Name</label>
                    <input type="text" class="form-control" id="inventoryName" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="inventoryCategory" data-i18n="category">Category</label>
                    <select class="form-control" id="inventoryCategory" required>
                        <option value="hair_products" data-i18n="hair_products">Hair Products</option>
                        <option value="styling_tools" data-i18n="styling_tools">Styling Tools</option>
                        <option value="color_products" data-i18n="color_products">Color Products</option>
                        <option value="accessories" data-i18n="accessories">Accessories</option>
                        <option value="other" data-i18n="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="inventoryQuantity" data-i18n="quantity">Quantity</label>
                    <input type="number" class="form-control" id="inventoryQuantity" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="inventoryLowStock" data-i18n="low_stock_threshold">Low Stock Threshold</label>
                    <input type="number" class="form-control" id="inventoryLowStock" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="inventoryNotes" data-i18n="notes">Notes</label>
                    <textarea class="form-control" id="inventoryNotes" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="HairSalonApp.closeModal('addInventoryModal')" data-i18n="cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="save_item">Save Item</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Inventory Usage Modal -->
    <div class="modal" id="viewUsageModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-history"></i>
                    <span data-i18n="view_usage_history">Product Usage History</span>
                </div>
                <button class="close-modal" onclick="HairSalonApp.closeModal('viewUsageModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="usage-history" id="usageHistoryList">
                <!-- Usage history will be populated here -->
            </div>
        </div>
    </div>

    <!-- View Date Appointments Modal -->
    <div class="modal" id="viewDateAppointmentsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-calendar-day"></i>
                    <span id="dateAppointmentsTitle">Appointments for Date</span>
                </div>
                <button class="close-modal" onclick="HairSalonApp.closeModal('viewDateAppointmentsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="card-header" style="border: none; padding: 0; margin-bottom: 15px;">
                <button class="btn btn-primary" onclick="HairSalonApp.addAppointmentForSelectedDate()">
                    <i class="fas fa-plus"></i> <span data-i18n="add_appointment">Add Appointment</span>
                </button>
            </div>
            <div class="data-list" id="dateAppointmentsList">
                <!-- Appointments for selected date will be populated here -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Update Available Notification -->
    <div class="update-notification" id="updateNotification" style="display: none;">
        <div style="flex: 1;">
            <i class="fas fa-sync-alt"></i>
            <span data-i18n="update_available">A new version is available!</span>
        </div>
        <button class="btn btn-primary btn-sm" id="updateAppButton" data-i18n="update_now">Update Now</button>
        <button class="btn btn-outline btn-sm" id="dismissUpdateButton" data-i18n="later">Later</button>
    </div>

    <!-- Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        <span data-i18n="install_prompt">Install HairSalon Pro for better experience</span>
        <button class="btn btn-primary btn-sm" id="installPromptButton" data-i18n="install">Install</button>
        <button class="btn btn-outline btn-sm" id="dismissInstallPrompt" data-i18n="dismiss">Dismiss</button>
    </div>
    
    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi-slash"></i>
        <span data-i18n="offline_message">You are offline</span>
    </div>
    
    <!-- Bottom Navigation (Mobile Only) -->
    <nav class="bottom-nav" id="bottomNav">
        <div class="bottom-nav-items">
            <a class="bottom-nav-item active" data-section="dashboard">
                <i class="fas fa-home"></i>
                <span data-i18n="dashboard">Dashboard</span>
            </a>
            <a class="bottom-nav-item" data-section="clients">
                <i class="fas fa-users"></i>
                <span data-i18n="clients">Clients</span>
            </a>
            <a class="bottom-nav-item" data-section="appointments">
                <i class="fas fa-calendar"></i>
                <span data-i18n="appointments">Appointments</span>
            </a>
            <a class="bottom-nav-item" data-section="calendar">
                <i class="fas fa-calendar-alt"></i>
                <span data-i18n="calendar">Calendar</span>
            </a>
            <a class="bottom-nav-item" data-section="settings">
                <i class="fas fa-cog"></i>
                <span data-i18n="settings">Settings</span>
            </a>
        </div>
    </nav>
    
    <!-- Confirmation Dialog with full accessibility support -->
    <div class="confirm-dialog" 
         id="confirmDialog"
         role="alertdialog"
         aria-modal="true"
         aria-labelledby="confirmTitle"
         aria-describedby="confirmMessage">
        <h3 id="confirmTitleWrapper"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i> <span id="confirmTitle">Confirm Action</span></h3>
        <p id="confirmMessage">Are you sure?</p>
        <div class="confirm-dialog-actions" role="group" aria-label="Dialog actions">
            <button class="btn btn-outline" id="confirmCancel" aria-label="Cancel and close dialog">Cancel</button>
            <button class="btn btn-danger" id="confirmOk" aria-label="Confirm deletion">Delete</button>
        </div>
    </div>
    
    <!-- Modal backdrop for confirmation (hidden from screen readers when not active) -->
    <div class="modal" id="confirmBackdrop" style="display: none;" aria-hidden="true"></div>

<script>
// HairSalon Pro - FIXED TIME SELECTION VERSION
class HairSalonPro {
    constructor() {
        this.currentLanguage = 'en';
        this.currentDate = new Date();
        this.deferredPrompt = null;
        this.selectedCalendarDate = null;
        this.editingClientId = null;
        this.editingInventoryId = null;
        this.editingAppointmentId = null;
        
        // Search debounce timeouts
        this.clientSearchTimeout = null;
        this.appointmentSearchTimeout = null;
        this.inventorySearchTimeout = null;
        
        // Current inventory category filter
        this.currentInventoryCategory = 'all';
        
        // Navigation history for back button management
        this.currentSection = 'dashboard';
        this.navigationHistory = [];
        
        // No currency settings - just numbers
        this.currencies = {
            'en': { symbol: '', code: '', rate: 1 },
            'es': { symbol: '', code: '', rate: 1 },
            'ru': { symbol: '', code: '', rate: 1 },
            'he': { symbol: '', code: '', rate: 1 }
        };
        
        // Initialize data
        this.clients = [];
        this.appointments = [];
        this.inventory = [];
        this.usageHistory = [];
        
        // Initialize settings with defaults
        this.settings = {
            businessName: 'HairSalon Pro',
            currencySymbol: '',
            defaultDuration: 60,
            lowStockDefault: 5,
            openTime: '09:00',
            closeTime: '18:00',
            workingDays: {
                mon: true,
                tue: true,
                wed: true,
                thu: true,
                fri: true,
                sat: false,
                sun: false
            },
            theme: 'dark',
            timeFormat: '12',
            dateFormat: 'MM/DD/YYYY',
            showToasts: true,
            enablePushNotifications: false
        };
        
        // Load data from localStorage with error handling
        this.loadFromLocalStorage();
        
        // Complete translations
        this.translations = {
            'en': {
                'app_name': 'HairSalon Pro',
                'tagline': 'Professional Hairdresser Management System',
                'dashboard': 'Dashboard',
                'clients': 'Clients',
                'appointments': 'Appointments',
                'upcoming_sessions': 'Upcoming Sessions',
                'calendar': 'Calendar',
                'inventory': 'Inventory',
                'export_data': 'Export Data',
                'settings': 'Settings',
                'business_name': 'Business Name',
                'currency_symbol': 'Currency Symbol',
                'default_appointment_duration': 'Default Appointment Duration',
                'default_low_stock_threshold': 'Default Low Stock Threshold',
                'business_hours': 'Business Hours',
                'working_days': 'Working Days',
                'reset_defaults': 'Reset to Defaults',
                'save_settings': 'Save Settings',
                'settings_saved': 'Settings saved successfully',
                'settings_reset': 'Settings reset to defaults',
                'main_navigation': 'Main Navigation',
                'quick_actions': 'Quick Actions',
                'add_client': 'Add Client',
                'schedule_appointment': 'Schedule Appointment',
                'install_app': 'Install App',
                'total_clients': 'Total Clients',
                'total_appointments': 'Total Appointments',
                'upcoming_appointments': 'Upcoming',
                'low_stock_items': 'Low Stock Items',
                'month_revenue': 'Month Revenue',
                'year_revenue': 'Year Revenue',
                'recent_appointments': 'Recent Appointments',
                'no_clients_yet': 'No clients yet',
                'build_client_database': 'Start building your client database by adding your first client.',
                'add_first_client': 'Add First Client',
                'no_appointments_yet': 'No appointments yet',
                'schedule_first_appointment': 'Schedule your first appointment to get started.',
                'add_first_appointment': 'Schedule First Appointment',
                'no_upcoming_sessions': 'No upcoming sessions',
                'no_inventory_items': 'No inventory items',
                'add_inventory_items': 'Add inventory items to track your salon supplies.',
                'add_first_item': 'Add First Item',
                'client_name': 'Client Name',
                'phone_number': 'Phone Number',
                'email_address': 'Email Address',
                'notes': 'Notes',
                'cancel': 'Cancel',
                'save_client': 'Save Client',
                'select_client': 'Select Client',
                'date': 'Date',
                'time': 'Time',
                'service': 'Service',
                'price': 'Price',
                'save_appointment': 'Save Appointment',
                'item_name': 'Item Name',
                'category': 'Category',
                'quantity': 'Quantity',
                'low_stock_threshold': 'Low Stock Threshold',
                'save_item': 'Save Item',
                'all_items': 'All Items',
                'hair_products': 'Hair Products',
                'styling_tools': 'Styling Tools',
                'color_products': 'Color Products',
                'accessories': 'Accessories',
                'other': 'Other',
                'export_description': 'Export your salon data for backup or analysis purposes.',
                'export_clients': 'Export Clients',
                'export_clients_desc': 'CSV format',
                'export_appointments': 'Export Appointments',
                'export_appointments_desc': 'CSV format',
                'export_inventory': 'Export Inventory',
                'export_inventory_desc': 'CSV format',
                'install_prompt': 'Install HairSalon Pro for better experience',
                'install': 'Install',
                'dismiss': 'Dismiss',
                'client_saved': 'Client saved successfully',
                'appointment_saved': 'Appointment scheduled successfully',
                'inventory_saved': 'Inventory item saved successfully',
                'edit_client': 'Edit Client',
                'update_client': 'Update Client',
                'client_updated': 'Client updated successfully',
                'edit_inventory_item': 'Edit Inventory Item',
                'update_item': 'Update Item',
                'inventory_updated': 'Inventory item updated successfully',
                'edit_appointment': 'Edit Appointment',
                'update_appointment': 'Update Appointment',
                'appointment_updated': 'Appointment updated successfully',
                'low_stock_warning': 'Low Stock Warning',
                'delete': 'Delete',
                'delete_confirmation': 'Are you sure you want to delete this item?',
                'item_deleted': 'Item deleted successfully',
                'delete_client': 'Delete Client',
                'confirm_delete_client': 'Are you sure you want to delete',
                'client_deleted': 'Client deleted',
                'client_restored': 'Client restored successfully',
                'client_not_found': 'Client not found',
                'delete_failed': 'Failed to delete. Please try again.',
                'restore_failed': 'Failed to restore. Please try again.',
                'undo': 'Undo',
                'undo_delete': 'Undo delete action',
                'client_actions': 'Client actions',
                'phone': 'Phone',
                'email': 'Email',
                'products_used': 'Products Used',
                'view_usage_history': 'View Usage History',
                'no_usage_history': 'No usage history for this product',
                'used_in_appointment': 'Used in appointment with',
                'quantity_used': 'Quantity Used',
                'insufficient_stock': 'Insufficient stock for product',
                'click_to_create_session': 'Click to create session on this date',
                'click_to_view_appointments': 'Click to view appointments on this date',
                'create_appointment_for': 'Create Appointment for',
                'appointments_for': 'Appointments for',
                'add_appointment': 'Add Appointment',
                'add_inventory_item': 'Add Inventory Item',
                'add_new_client': 'Add New Client',
                'appearance': 'Appearance',
                'time_format': 'Time Format',
                'date_format': 'Date Format',
                'notifications': 'Notifications',
                'search_clients_placeholder': 'Search clients by name, phone or email...',
                'search_appointments_placeholder': 'Search appointments by client, service...',
                'search_inventory_placeholder': 'Search inventory by name or category...',
                'enter_salon_name_placeholder': 'Enter your salon name',
                'currency_placeholder': '$ or € or £',
                'enter_client_name_placeholder': 'Enter client full name',
                'phone_placeholder': '+1 234 567 8900',
                'email_placeholder': 'client@example.com',
                'notes_placeholder': 'Hair preferences, allergies, etc.',
                'leave_empty_currency': 'Leave empty for no currency symbol',
                'applied_new_inventory': 'Applied when adding new inventory items',
                'opening_time': 'Opening Time',
                'closing_time': 'Closing Time',
                'monday': 'Monday',
                'tuesday': 'Tuesday',
                'wednesday': 'Wednesday',
                'thursday': 'Thursday',
                'friday': 'Friday',
                'saturday': 'Saturday',
                'sunday': 'Sunday',
                'dark_mode': 'Dark Mode',
                'light_mode': 'Light Mode',
                '12_hour': '12-hour (AM/PM)',
                '24_hour': '24-hour',
                'show_toast_notifications': 'Show toast notifications',
                'enable_push_notifications': 'Enable push notifications for upcoming sessions',
                'push_notification_info': 'Get notified 24 hours and 1 hour before appointments',
                'update_available': 'A new version is available!',
                'update_now': 'Update Now',
                'later': 'Later',
                'notification_permission_denied': 'Notification permission denied. Enable in browser settings.',
                'notifications_enabled': 'Push notifications enabled successfully',
                'appointment_reminder_24h': 'Appointment reminder: You have an appointment tomorrow',
                'appointment_reminder_1h': 'Appointment reminder: You have an appointment in 1 hour',
                'backup_all_data': 'Backup All Data',
                'json_format': 'JSON format',
                'restore_data': 'Restore Data',
                'from_backup_file': 'From backup file',
                'select_products_used': 'Select products used during this appointment:',
                'available_units': 'Available',
                'units': 'units',
                'qty_label': 'Qty:',
                'no_data_to_export': 'No data to export',
                'data_exported_successfully': 'Data exported successfully',
                'backup_created_successfully': 'Backup created successfully',
                'data_restored_successfully': 'Data restored successfully',
                'failed_to_restore': 'Failed to restore backup. Invalid file format.',
                'failed_to_save': 'Failed to save data. Storage might be full.',
                'products_used_label': 'Products used:',
                'try_adjusting_search': 'Try adjusting your search query',
                'try_adjusting_search_category': 'Try adjusting your search query or selecting a different category',
                'no_items_found_in': 'No items found in',
                'category_word': 'category',
                'no_inventory_available': 'No inventory items available',
                'offline_message': 'You are offline',
                'please_enter_client_name': 'Please enter a client name',
                'please_enter_valid_phone': 'Please enter a valid phone number',
                'please_enter_valid_email': 'Please enter a valid email address',
                'please_select_client': 'Please select a client',
                'please_select_date': 'Please select a date',
                'please_select_time': 'Please select a time for the appointment',
                'please_enter_service': 'Please enter a service name',
                'please_enter_valid_price': 'Please enter a valid price',
                'please_select_valid_date': 'Please select a valid date (today or future)',
                'please_enter_item_name': 'Please enter an item name',
                'please_enter_valid_quantity': 'Please enter a valid quantity',
                'please_enter_valid_threshold': 'Please enter a valid low stock threshold'
            },
            'es': {
                'app_name': 'HairSalon Pro',
                'tagline': 'Sistema Profesional de Gestión de Peluquería',
                'dashboard': 'Panel',
                'clients': 'Clientes',
                'appointments': 'Citas',
                'upcoming_sessions': 'Próximas Sesiones',
                'calendar': 'Calendario',
                'inventory': 'Inventario',
                'export_data': 'Exportar Datos',
                'settings': 'Configuración',
                'business_name': 'Nombre del Negocio',
                'currency_symbol': 'Símbolo de Moneda',
                'default_appointment_duration': 'Duración Predeterminada de Cita',
                'default_low_stock_threshold': 'Umbral Predeterminado de Stock Bajo',
                'business_hours': 'Horario de Negocio',
                'working_days': 'Días Laborables',
                'reset_defaults': 'Restablecer Valores Predeterminados',
                'save_settings': 'Guardar Configuración',
                'settings_saved': 'Configuración guardada con éxito',
                'settings_reset': 'Configuración restablecida',
                'main_navigation': 'Navegación Principal',
                'quick_actions': 'Acciones Rápidas',
                'add_client': 'Agregar Cliente',
                'schedule_appointment': 'Programar Cita',
                'install_app': 'Instalar App',
                'total_clients': 'Clientes Totales',
                'total_appointments': 'Citas Totales',
                'upcoming_appointments': 'Próximas',
                'low_stock_items': 'Artículos Bajos',
                'month_revenue': 'Ingresos del Mes',
                'year_revenue': 'Ingresos del Año',
                'recent_appointments': 'Citas Recientes',
                'no_clients_yet': 'Aún no hay clientes',
                'build_client_database': 'Comience a construir su base de datos de clientes agregando su primer cliente.',
                'add_first_client': 'Agregar Primer Cliente',
                'no_appointments_yet': 'Aún no hay citas',
                'schedule_first_appointment': 'Programe su primera cita para comenzar.',
                'add_first_appointment': 'Programar Primera Cita',
                'no_upcoming_sessions': 'No hay sesiones próximas',
                'no_inventory_items': 'No hay artículos en inventario',
                'add_inventory_items': 'Agregue artículos de inventario para realizar un seguimiento de los suministros de su salón.',
                'add_first_item': 'Agregar Primer Artículo',
                'client_name': 'Nombre del Cliente',
                'phone_number': 'Número de Teléfono',
                'email_address': 'Correo Electrónico',
                'notes': 'Notas',
                'cancel': 'Cancelar',
                'save_client': 'Guardar Cliente',
                'select_client': 'Seleccionar Cliente',
                'date': 'Fecha',
                'time': 'Hora',
                'service': 'Servicio',
                'price': 'Precio',
                'save_appointment': 'Guardar Cita',
                'item_name': 'Nombre del Artículo',
                'category': 'Categoría',
                'quantity': 'Cantidad',
                'low_stock_threshold': 'Umbral de Stock Bajo',
                'save_item': 'Guardar Artículo',
                'all_items': 'Todos los Artículos',
                'hair_products': 'Productos para el Cabello',
                'styling_tools': 'Herramientas de Estilismo',
                'color_products': 'Productos de Color',
                'accessories': 'Accesorios',
                'other': 'Otro',
                'export_description': 'Exporte los datos de su salón para copia de seguridad o análisis.',
                'export_clients': 'Exportar Clientes',
                'export_clients_desc': 'Formato CSV',
                'export_appointments': 'Exportar Citas',
                'export_appointments_desc': 'Formato CSV',
                'export_inventory': 'Exportar Inventario',
                'export_inventory_desc': 'Formato CSV',
                'install_prompt': 'Instale HairSalon Pro para una mejor experiencia',
                'install': 'Instalar',
                'dismiss': 'Descartar',
                'client_saved': 'Cliente guardado exitosamente',
                'appointment_saved': 'Cita programada exitosamente',
                'inventory_saved': 'Artículo de inventario guardado exitosamente',
                'edit_client': 'Editar Cliente',
                'update_client': 'Actualizar Cliente',
                'client_updated': 'Cliente actualizado exitosamente',
                'edit_inventory_item': 'Editar Artículo de Inventario',
                'update_item': 'Actualizar Artículo',
                'inventory_updated': 'Artículo de inventario actualizado exitosamente',
                'edit_appointment': 'Editar Cita',
                'update_appointment': 'Actualizar Cita',
                'appointment_updated': 'Cita actualizada exitosamente',
                'low_stock_warning': 'Advertencia de Stock Bajo',
                'delete': 'Eliminar',
                'delete_confirmation': '¿Está seguro de que desea eliminar este elemento?',
                'item_deleted': 'Elemento eliminado exitosamente',
                'delete_client': 'Eliminar Cliente',
                'confirm_delete_client': '¿Está seguro de que desea eliminar a',
                'client_deleted': 'Cliente eliminado',
                'client_restored': 'Cliente restaurado exitosamente',
                'client_not_found': 'Cliente no encontrado',
                'delete_failed': 'Error al eliminar. Por favor, inténtelo de nuevo.',
                'restore_failed': 'Error al restaurar. Por favor, inténtelo de nuevo.',
                'undo': 'Deshacer',
                'undo_delete': 'Deshacer acción de eliminar',
                'client_actions': 'Acciones de cliente',
                'phone': 'Teléfono',
                'email': 'Correo electrónico',
                'products_used': 'Productos Utilizados',
                'view_usage_history': 'Ver Historial de Uso',
                'no_usage_history': 'No hay historial de uso para este producto',
                'used_in_appointment': 'Usado en cita con',
                'quantity_used': 'Cantidad Usada',
                'insufficient_stock': 'Stock insuficiente para el producto',
                'click_to_create_session': 'Haga clic para crear sesión en esta fecha',
                'click_to_view_appointments': 'Haga clic para ver las citas en esta fecha',
                'create_appointment_for': 'Crear cita para',
                'appointments_for': 'Citas para',
                'add_appointment': 'Agregar Cita',
                'add_inventory_item': 'Agregar Artículo de Inventario',
                'add_new_client': 'Agregar Nuevo Cliente',
                'appearance': 'Apariencia',
                'time_format': 'Formato de Hora',
                'date_format': 'Formato de Fecha',
                'notifications': 'Notificaciones',
                'search_clients_placeholder': 'Buscar clientes por nombre, teléfono o correo...',
                'search_appointments_placeholder': 'Buscar citas por cliente, servicio...',
                'search_inventory_placeholder': 'Buscar inventario por nombre o categoría...',
                'enter_salon_name_placeholder': 'Ingrese el nombre de su salón',
                'currency_placeholder': '$ o € o £',
                'enter_client_name_placeholder': 'Ingrese el nombre completo del cliente',
                'phone_placeholder': '+1 234 567 8900',
                'email_placeholder': 'cliente@ejemplo.com',
                'notes_placeholder': 'Preferencias de cabello, alergias, etc.',
                'leave_empty_currency': 'Dejar vacío para ningún símbolo de moneda',
                'applied_new_inventory': 'Aplicado al agregar nuevos artículos de inventario',
                'opening_time': 'Hora de Apertura',
                'closing_time': 'Hora de Cierre',
                'monday': 'Lunes',
                'tuesday': 'Martes',
                'wednesday': 'Miércoles',
                'thursday': 'Jueves',
                'friday': 'Viernes',
                'saturday': 'Sábado',
                'sunday': 'Domingo',
                'dark_mode': 'Modo Oscuro',
                'light_mode': 'Modo Claro',
                '12_hour': '12 horas (AM/PM)',
                '24_hour': '24 horas',
                'show_toast_notifications': 'Mostrar notificaciones emergentes',
                'enable_push_notifications': 'Habilitar notificaciones push para próximas sesiones',
                'push_notification_info': 'Recibe notificaciones 24 horas y 1 hora antes de las citas',
                'update_available': '¡Nueva versión disponible!',
                'update_now': 'Actualizar Ahora',
                'later': 'Más Tarde',
                'notification_permission_denied': 'Permiso de notificación denegado. Habilitar en configuración del navegador.',
                'notifications_enabled': 'Notificaciones push habilitadas exitosamente',
                'appointment_reminder_24h': 'Recordatorio de cita: Tienes una cita mañana',
                'appointment_reminder_1h': 'Recordatorio de cita: Tienes una cita en 1 hora',
                'backup_all_data': 'Respaldar Todos los Datos',
                'json_format': 'Formato JSON',
                'restore_data': 'Restaurar Datos',
                'from_backup_file': 'Desde archivo de respaldo',
                'select_products_used': 'Seleccione los productos utilizados durante esta cita:',
                'available_units': 'Disponible',
                'units': 'unidades',
                'qty_label': 'Cant:',
                'no_data_to_export': 'No hay datos para exportar',
                'data_exported_successfully': 'Datos exportados con éxito',
                'backup_created_successfully': 'Respaldo creado con éxito',
                'data_restored_successfully': 'Datos restaurados con éxito',
                'failed_to_restore': 'Error al restaurar respaldo. Formato de archivo inválido.',
                'failed_to_save': 'Error al guardar datos. El almacenamiento puede estar lleno.',
                'products_used_label': 'Productos utilizados:',
                'try_adjusting_search': 'Intente ajustar su consulta de búsqueda',
                'try_adjusting_search_category': 'Intente ajustar su búsqueda o seleccionar una categoría diferente',
                'no_items_found_in': 'No se encontraron elementos en',
                'category_word': 'categoría',
                'no_inventory_available': 'No hay artículos de inventario disponibles',
                'offline_message': 'Estás desconectado',
                'please_enter_client_name': 'Por favor ingrese un nombre de cliente',
                'please_enter_valid_phone': 'Por favor ingrese un número de teléfono válido',
                'please_enter_valid_email': 'Por favor ingrese una dirección de correo válida',
                'please_select_client': 'Por favor seleccione un cliente',
                'please_select_date': 'Por favor seleccione una fecha',
                'please_select_time': 'Por favor seleccione una hora para la cita',
                'please_enter_service': 'Por favor ingrese un nombre de servicio',
                'please_enter_valid_price': 'Por favor ingrese un precio válido',
                'please_select_valid_date': 'Por favor seleccione una fecha válida (hoy o futuro)',
                'please_enter_item_name': 'Por favor ingrese un nombre de artículo',
                'please_enter_valid_quantity': 'Por favor ingrese una cantidad válida',
                'please_enter_valid_threshold': 'Por favor ingrese un umbral de stock bajo válido'
            },
            'ru': {
                'app_name': 'HairSalon Pro',
                'tagline': 'Профессиональная система управления салоном красоты',
                'dashboard': 'Панель управления',
                'clients': 'Клиенты',
                'appointments': 'Записи',
                'upcoming_sessions': 'Ближайшие сеансы',
                'calendar': 'Календарь',
                'inventory': 'Инвентарь',
                'export_data': 'Экспорт данных',
                'settings': 'Настройки',
                'business_name': 'Название бизнеса',
                'currency_symbol': 'Символ валюты',
                'default_appointment_duration': 'Продолжительность записи по умолчанию',
                'default_low_stock_threshold': 'Порог низкого запаса по умолчанию',
                'business_hours': 'Часы работы',
                'working_days': 'Рабочие дни',
                'reset_defaults': 'Сбросить по умолчанию',
                'save_settings': 'Сохранить настройки',
                'settings_saved': 'Настройки сохранены успешно',
                'settings_reset': 'Настройки сброшены',
                'main_navigation': 'Основная навигация',
                'quick_actions': 'Быстрые действия',
                'add_client': 'Добавить клиента',
                'schedule_appointment': 'Запланировать запись',
                'install_app': 'Установить приложение',
                'total_clients': 'Всего клиентов',
                'total_appointments': 'Всего записей',
                'upcoming_appointments': 'Ближайшие',
                'low_stock_items': 'Товары с низким запасом',
                'month_revenue': 'Доход за месяц',
                'year_revenue': 'Доход за год',
                'recent_appointments': 'Недавние записи',
                'no_clients_yet': 'Пока нет клиентов',
                'build_client_database': 'Начните создавать свою базу данных клиентов, добавив первого клиента.',
                'add_first_client': 'Добавить первого клиента',
                'no_appointments_yet': 'Пока нет записей',
                'schedule_first_appointment': 'Запланируйте свою первую запись, чтобы начать.',
                'add_first_appointment': 'Запланировать первую запись',
                'no_upcoming_sessions': 'Нет предстоящих сеансов',
                'no_inventory_items': 'Нет товаров в инвентаре',
                'add_inventory_items': 'Добавьте товары в инвентарь для отслеживания поставок вашего салона.',
                'add_first_item': 'Добавить первый товар',
                'client_name': 'Имя клиента',
                'phone_number': 'Номер телефона',
                'email_address': 'Адрес электронной почты',
                'notes': 'Заметки',
                'cancel': 'Отмена',
                'save_client': 'Сохранить клиента',
                'select_client': 'Выбрать клиента',
                'date': 'Дата',
                'time': 'Время',
                'service': 'Услуга',
                'price': 'Цена',
                'save_appointment': 'Сохранить запись',
                'item_name': 'Название товара',
                'category': 'Категория',
                'quantity': 'Количество',
                'low_stock_threshold': 'Порог низкого запаса',
                'save_item': 'Сохранить товар',
                'all_items': 'Все товары',
                'hair_products': 'Средства для волос',
                'styling_tools': 'Инструменты для укладки',
                'color_products': 'Красящие средства',
                'accessories': 'Аксессуары',
                'other': 'Другое',
                'export_description': 'Экспортируйте данные вашего салона для резервного копирования или анализа.',
                'export_clients': 'Экспорт клиентов',
                'export_clients_desc': 'Формат CSV',
                'export_appointments': 'Экспорт записей',
                'export_appointments_desc': 'Формат CSV',
                'export_inventory': 'Экспорт инвентаря',
                'export_inventory_desc': 'Формат CSV',
                'install_prompt': 'Установите HairSalon Pro для лучшего опыта',
                'install': 'Установить',
                'dismiss': 'Отклонить',
                'client_saved': 'Клиент успешно сохранен',
                'appointment_saved': 'Запись успешно запланирована',
                'inventory_saved': 'Товар инвентаря успешно сохранен',
                'edit_client': 'Редактировать клиента',
                'update_client': 'Обновить клиента',
                'client_updated': 'Клиент успешно обновлен',
                'edit_inventory_item': 'Редактировать товар инвентаря',
                'update_item': 'Обновить товар',
                'inventory_updated': 'Товар инвентаря успешно обновлен',
                'edit_appointment': 'Редактировать запись',
                'update_appointment': 'Обновить запись',
                'appointment_updated': 'Запись успешно обновлена',
                'low_stock_warning': 'Предупреждение о низком запасе',
                'delete': 'Удалить',
                'delete_confirmation': 'Вы уверены, что хотите удалить этот элемент?',
                'item_deleted': 'Элемент успешно удален',
                'delete_client': 'Удалить клиента',
                'confirm_delete_client': 'Вы уверены, что хотите удалить',
                'client_deleted': 'Клиент удален',
                'client_restored': 'Клиент успешно восстановлен',
                'client_not_found': 'Клиент не найден',
                'delete_failed': 'Ошибка при удалении. Пожалуйста, попробуйте снова.',
                'restore_failed': 'Ошибка при восстановлении. Пожалуйста, попробуйте снова.',
                'undo': 'Отменить',
                'undo_delete': 'Отменить удаление',
                'client_actions': 'Действия с клиентом',
                'phone': 'Телефон',
                'email': 'Эл. почта',
                'products_used': 'Использованные продукты',
                'view_usage_history': 'Просмотреть историю использования',
                'no_usage_history': 'Нет истории использования для этого продукта',
                'used_in_appointment': 'Использовано в записи с',
                'quantity_used': 'Количество использовано',
                'insufficient_stock': 'Недостаточно запасов для продукта',
                'click_to_create_session': 'Нажмите, чтобы создать сеанс на эту дату',
                'click_to_view_appointments': 'Нажмите, чтобы просмотреть записи на эту дату',
                'create_appointment_for': 'Создать запись на',
                'appointments_for': 'Записи на',
                'add_appointment': 'Добавить запись',
                'add_inventory_item': 'Добавить товар в инвентарь',
                'add_new_client': 'Добавить нового клиента',
                'appearance': 'Внешний вид',
                'time_format': 'Формат времени',
                'date_format': 'Формат даты',
                'notifications': 'Уведомления',
                'search_clients_placeholder': 'Поиск клиентов по имени, телефону или email...',
                'search_appointments_placeholder': 'Поиск записей по клиенту, услуге...',
                'search_inventory_placeholder': 'Поиск в инвентаре по названию или категории...',
                'enter_salon_name_placeholder': 'Введите название вашего салона',
                'currency_placeholder': '₽ или $ или €',
                'enter_client_name_placeholder': 'Введите полное имя клиента',
                'phone_placeholder': '+7 900 123 45 67',
                'email_placeholder': 'клиент@пример.ру',
                'notes_placeholder': 'Предпочтения по прическе, аллергии и т.д.',
                'leave_empty_currency': 'Оставьте пустым для отсутствия символа валюты',
                'applied_new_inventory': 'Применяется при добавлении новых товаров в инвентарь',
                'opening_time': 'Время открытия',
                'closing_time': 'Время закрытия',
                'monday': 'Понедельник',
                'tuesday': 'Вторник',
                'wednesday': 'Среда',
                'thursday': 'Четверг',
                'friday': 'Пятница',
                'saturday': 'Суббота',
                'sunday': 'Воскресенье',
                'dark_mode': 'Темный режим',
                'light_mode': 'Светлый режим',
                '12_hour': '12-часовой (AM/PM)',
                '24_hour': '24-часовой',
                'show_toast_notifications': 'Показывать всплывающие уведомления',
                'enable_push_notifications': 'Включить push-уведомления для предстоящих сеансов',
                'push_notification_info': 'Получайте уведомления за 24 часа и за 1 час до записи',
                'update_available': 'Доступна новая версия!',
                'update_now': 'Обновить сейчас',
                'later': 'Позже',
                'notification_permission_denied': 'Разрешение на уведомления отклонено. Включите в настройках браузера.',
                'notifications_enabled': 'Push-уведомления успешно включены',
                'appointment_reminder_24h': 'Напоминание о записи: У вас запись завтра',
                'appointment_reminder_1h': 'Напоминание о записи: У вас запись через 1 час',
                'backup_all_data': 'Резервная копия всех данных',
                'json_format': 'Формат JSON',
                'restore_data': 'Восстановить данные',
                'from_backup_file': 'Из файла резервной копии',
                'select_products_used': 'Выберите продукты, использованные во время этой записи:',
                'available_units': 'Доступно',
                'units': 'единиц',
                'qty_label': 'Кол-во:',
                'no_data_to_export': 'Нет данных для экспорта',
                'data_exported_successfully': 'Данные успешно экспортированы',
                'backup_created_successfully': 'Резервная копия успешно создана',
                'data_restored_successfully': 'Данные успешно восстановлены',
                'failed_to_restore': 'Не удалось восстановить резервную копию. Неверный формат файла.',
                'failed_to_save': 'Не удалось сохранить данные. Возможно, хранилище заполнено.',
                'products_used_label': 'Использованные продукты:',
                'try_adjusting_search': 'Попробуйте изменить поисковый запрос',
                'try_adjusting_search_category': 'Попробуйте изменить запрос или выбрать другую категорию',
                'no_items_found_in': 'Товары не найдены в категории',
                'category_word': 'категория',
                'no_inventory_available': 'Нет доступных товаров в инвентаре',
                'offline_message': 'Вы не в сети',
                'please_enter_client_name': 'Пожалуйста, введите имя клиента',
                'please_enter_valid_phone': 'Пожалуйста, введите действительный номер телефона',
                'please_enter_valid_email': 'Пожалуйста, введите действительный адрес электронной почты',
                'please_select_client': 'Пожалуйста, выберите клиента',
                'please_select_date': 'Пожалуйста, выберите дату',
                'please_select_time': 'Пожалуйста, выберите время для записи',
                'please_enter_service': 'Пожалуйста, введите название услуги',
                'please_enter_valid_price': 'Пожалуйста, введите действительную цену',
                'please_select_valid_date': 'Пожалуйста, выберите действительную дату (сегодня или будущее)',
                'please_enter_item_name': 'Пожалуйста, введите название товара',
                'please_enter_valid_quantity': 'Пожалуйста, введите действительное количество',
                'please_enter_valid_threshold': 'Пожалуйста, введите действительный порог низкого запаса'
            },
            'he': {
                'app_name': 'HairSalon Pro',
                'tagline': 'מערכת ניהול מקצועית למספרות',
                'dashboard': 'לוח בקרה',
                'clients': 'לקוחות',
                'appointments': 'תורים',
                'upcoming_sessions': 'פגישות קרובות',
                'calendar': 'לוח שנה',
                'inventory': 'מלאי',
                'export_data': 'ייצוא נתונים',
                'settings': 'הגדרות',
                'business_name': 'שם העסק',
                'currency_symbol': 'סמל מטבע',
                'default_appointment_duration': 'משך תור ברירת מחדל',
                'default_low_stock_threshold': 'סף מלאי נמוך ברירת מחדל',
                'business_hours': 'שעות פעילות',
                'working_days': 'ימי עבודה',
                'reset_defaults': 'אפס להגדרות ברירת מחדל',
                'save_settings': 'שמור הגדרות',
                'settings_saved': 'ההגדרות נשמרו בהצלחה',
                'settings_reset': 'ההגדרות אופסו',
                'main_navigation': 'ניווט ראשי',
                'quick_actions': 'פעולות מהירות',
                'add_client': 'הוסף לקוח',
                'schedule_appointment': 'קבע תור',
                'install_app': 'התקן אפליקציה',
                'total_clients': 'סה"כ לקוחות',
                'total_appointments': 'סה"כ תורים',
                'upcoming_appointments': 'קרובים',
                'low_stock_items': 'פריטים במלאי נמוך',
                'month_revenue': 'הכנסה חודשית',
                'year_revenue': 'הכנסה שנתית',
                'recent_appointments': 'תורים אחרונים',
                'no_clients_yet': 'אין עדיין לקוחות',
                'build_client_database': 'התחל לבנות את מסד הנתונים של הלקוחות שלך על ידי הוספת הלקוח הראשון שלך.',
                'add_first_client': 'הוסף לקוח ראשון',
                'no_appointments_yet': 'אין עדיין תורים',
                'schedule_first_appointment': 'קבע את התור הראשון שלך כדי להתחיל.',
                'add_first_appointment': 'קבע תור ראשון',
                'no_upcoming_sessions': 'אין פגישות קרובות',
                'no_inventory_items': 'אין פריטים במלאי',
                'add_inventory_items': 'הוסף פריטי מלאי כדי לעקוב אחר האספקה של הסלון שלך.',
                'add_first_item': 'הוסף פריט ראשון',
                'client_name': 'שם הלקוח',
                'phone_number': 'מספר טלפון',
                'email_address': 'כתובת אימייל',
                'notes': 'הערות',
                'cancel': 'ביטול',
                'save_client': 'שמור לקוח',
                'select_client': 'בחר לקוח',
                'date': 'תאריך',
                'time': 'שעה',
                'service': 'שירות',
                'price': 'מחיר',
                'save_appointment': 'שמור תור',
                'item_name': 'שם הפריט',
                'category': 'קטגוריה',
                'quantity': 'כמות',
                'low_stock_threshold': 'סף מלאי נמוך',
                'save_item': 'שמור פריט',
                'all_items': 'כל הפריטים',
                'hair_products': 'מוצרי שיער',
                'styling_tools': 'כלי עיצוב',
                'color_products': 'מוצרי צבע',
                'accessories': 'אקססוריז',
                'other': 'אחר',
                'export_description': 'ייצא את נתוני הסלון שלך למטרות גיבוי או ניתוח.',
                'export_clients': 'ייצא לקוחות',
                'export_clients_desc': 'פורמט CSV',
                'export_appointments': 'ייצא תורים',
                'export_appointments_desc': 'פורמט CSV',
                'export_inventory': 'ייצא מלאי',
                'export_inventory_desc': 'פורמט CSV',
                'install_prompt': 'התקן את HairSalon Pro לחוויה טובה יותר',
                'install': 'התקן',
                'dismiss': 'התעלם',
                'client_saved': 'הלקוח נשמר בהצלחה',
                'appointment_saved': 'התור נקבע בהצלחה',
                'inventory_saved': 'פריט המלאי נשמר בהצלחה',
                'edit_client': 'ערוך לקוח',
                'update_client': 'עדכן לקוח',
                'client_updated': 'הלקוח עודכן בהצלחה',
                'edit_inventory_item': 'ערוך פריט מלאי',
                'update_item': 'עדכן פריט',
                'inventory_updated': 'פריט המלאי עודכן בהצלחה',
                'edit_appointment': 'ערוך תור',
                'update_appointment': 'עדכן תור',
                'appointment_updated': 'התור עודכן בהצלחה',
                'low_stock_warning': 'אזהרת מלאי נמוך',
                'delete': 'מחק',
                'delete_confirmation': 'האם אתה בטוח שברצונך למחוק פריט זה?',
                'item_deleted': 'הפריט נמחק בהצלחה',
                'delete_client': 'מחק לקוח',
                'confirm_delete_client': 'האם אתה בטוח שברצונך למחוק את',
                'client_deleted': 'הלקוח נמחק',
                'client_restored': 'הלקוח שוחזר בהצלחה',
                'client_not_found': 'הלקוח לא נמצא',
                'delete_failed': 'המחיקה נכשלה. נסה שוב.',
                'restore_failed': 'השחזור נכשל. נסה שוב.',
                'undo': 'בטל',
                'undo_delete': 'בטל מחיקה',
                'client_actions': 'פעולות לקוח',
                'phone': 'טלפון',
                'email': 'אימייל',
                'products_used': 'מוצרים בשימוש',
                'view_usage_history': 'צפה בהיסטוריית שימוש',
                'no_usage_history': 'אין היסטוריית שימוש למוצר זה',
                'used_in_appointment': 'שומש בתור עם',
                'quantity_used': 'כמות משומשת',
                'insufficient_stock': 'מלאי לא מספיק למוצר',
                'click_to_create_session': 'לחץ כדי ליצור פגישה בתאריך זה',
                'click_to_view_appointments': 'לחץ כדי לצפות בתורים בתאריך זה',
                'create_appointment_for': 'צור תור עבור',
                'appointments_for': 'תורים עבור',
                'add_appointment': 'הוסף תור',
                'add_inventory_item': 'הוסף פריט מלאי',
                'add_new_client': 'הוסף לקוח חדש',
                'appearance': 'מראה',
                'time_format': 'פורמט שעה',
                'date_format': 'פורמט תאריך',
                'notifications': 'התראות',
                'search_clients_placeholder': 'חפש לקוחות לפי שם, טלפון או אימייל...',
                'search_appointments_placeholder': 'חפש תורים לפי לקוח, שירות...',
                'search_inventory_placeholder': 'חפש במלאי לפי שם או קטגוריה...',
                'enter_salon_name_placeholder': 'הזן את שם הסלון שלך',
                'currency_placeholder': '₪ או $ או €',
                'enter_client_name_placeholder': 'הזן את השם המלא של הלקוח',
                'phone_placeholder': '+972 50 123 4567',
                'email_placeholder': 'לקוח@דוגמה.com',
                'notes_placeholder': 'העדפות שיער, אלרגיות וכו\'.',
                'leave_empty_currency': 'השאר ריק ללא סמל מטבע',
                'applied_new_inventory': 'מוחל בעת הוספת פריטי מלאי חדשים',
                'opening_time': 'שעת פתיחה',
                'closing_time': 'שעת סגירה',
                'monday': 'שני',
                'tuesday': 'שלישי',
                'wednesday': 'רביעי',
                'thursday': 'חמישי',
                'friday': 'שישי',
                'saturday': 'שבת',
                'sunday': 'ראשון',
                'dark_mode': 'מצב כהה',
                'light_mode': 'מצב בהיר',
                '12_hour': '12 שעות (AM/PM)',
                '24_hour': '24 שעות',
                'show_toast_notifications': 'הצג התראות קופצות',
                'enable_push_notifications': 'הפעל התראות דחיפה עבור פגישות קרובות',
                'push_notification_info': 'קבל התראות 24 שעות ושעה לפני התורים',
                'update_available': 'גרסה חדשה זמינה!',
                'update_now': 'עדכן עכשיו',
                'later': 'מאוחר יותר',
                'notification_permission_denied': 'הרשאת התראות נדחתה. הפעל בהגדרות הדפדפן.',
                'notifications_enabled': 'התראות דחיפה הופעלו בהצלחה',
                'appointment_reminder_24h': 'תזכורת תור: יש לך תור מחר',
                'appointment_reminder_1h': 'תזכורת תור: יש לך תור בעוד שעה',
                'backup_all_data': 'גיבוי כל הנתונים',
                'json_format': 'פורמט JSON',
                'restore_data': 'שחזר נתונים',
                'from_backup_file': 'מקובץ גיבוי',
                'select_products_used': 'בחר מוצרים בשימוש במהלך תור זה:',
                'available_units': 'זמין',
                'units': 'יחידות',
                'qty_label': 'כמות:',
                'no_data_to_export': 'אין נתונים לייצוא',
                'data_exported_successfully': 'הנתונים יוצאו בהצלחה',
                'backup_created_successfully': 'הגיבוי נוצר בהצלחה',
                'data_restored_successfully': 'הנתונים שוחזרו בהצלחה',
                'failed_to_restore': 'שחזור הגיבוי נכשל. פורמט קובץ לא חוקי.',
                'failed_to_save': 'שמירת הנתונים נכשלה. ייתכן שהאחסון מלא.',
                'products_used_label': 'מוצרים בשימוש:',
                'try_adjusting_search': 'נסה להתאים את שאילתת החיפוש',
                'try_adjusting_search_category': 'נסה להתאים את החיפוש או לבחור קטגוריה אחרת',
                'no_items_found_in': 'לא נמצאו פריטים ב',
                'category_word': 'קטגוריה',
                'no_inventory_available': 'אין פריטי מלאי זמינים',
                'offline_message': 'אתה לא מחובר',
                'please_enter_client_name': 'אנא הזן שם לקוח',
                'please_enter_valid_phone': 'אנא הזן מספר טלפון תקף',
                'please_enter_valid_email': 'אנא הזן כתובת אימייל תקפה',
                'please_select_client': 'אנא בחר לקוח',
                'please_select_date': 'אנא בחר תאריך',
                'please_select_time': 'אנא בחר שעה לתור',
                'please_enter_service': 'אנא הזן שם שירות',
                'please_enter_valid_price': 'אנא הזן מחיר תקף',
                'please_select_valid_date': 'אנא בחר תאריך תקף (היום או עתיד)',
                'please_enter_item_name': 'אנא הזן שם פריט',
                'please_enter_valid_quantity': 'אנא הזן כמות תקפה',
                'please_enter_valid_threshold': 'אנא הזן סף מלאי נמוך תקף'
            }
        };
        
        this.init();
    }
    
    init() {
        this.setupEventListeners();
        this.setupLanguage();
        this.applyTheme();
        this.updateDashboard();
        this.renderCalendar();
        this.checkInstallPrompt();
        this.setupMobileMenu();
        this.updateOnlineStatus();
        this.setupBackButtonPrevention();
        this.setupServiceWorkerUpdateListener();
        
        // Start notification checker if enabled
        if (this.settings.enablePushNotifications && Notification.permission === 'granted') {
            this.startNotificationChecker();
        }
        
        console.log('💇‍♀️ HairSalon Pro - Enhanced Version Loaded');
    }
    
    applyTheme() {
        // Apply saved theme on page load
        if (this.settings.theme === 'light') {
            document.body.classList.add('light-mode');
        } else {
            document.body.classList.remove('light-mode');
        }
    }
    
    setupEventListeners() {
        // Navigation (sidebar)
        document.querySelectorAll('.nav-link[data-section]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                this.showSection(e.currentTarget.getAttribute('data-section'));
            });
        });
        
        // Bottom navigation (mobile)
        document.querySelectorAll('.bottom-nav-item[data-section]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                this.showSection(e.currentTarget.getAttribute('data-section'));
            });
        });
        
        // Quick actions
        document.getElementById('quickAddClient').addEventListener('click', () => {
            this.openModal('addClientModal');
        });
        
        document.getElementById('quickAddAppointment').addEventListener('click', () => {
            this.openModal('addAppointmentModal');
        });
        
        // Forms
        document.getElementById('addClientForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.saveClient();
        });
        
        document.getElementById('addAppointmentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.saveAppointment();
        });
        
        document.getElementById('addInventoryForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.saveInventoryItem();
        });
        
        document.getElementById('settingsForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.saveSettings();
        });
        
        // Language selector
        document.getElementById('languageSelect').addEventListener('change', (e) => {
            this.changeLanguage(e.target.value);
        });
        
        // Calendar navigation
        document.getElementById('prevMonth').addEventListener('click', () => {
            this.currentDate.setMonth(this.currentDate.getMonth() - 1);
            this.renderCalendar();
        });
        
        document.getElementById('nextMonth').addEventListener('click', () => {
            this.currentDate.setMonth(this.currentDate.getMonth() + 1);
            this.renderCalendar();
        });
        
        // Install button
        document.getElementById('installButton').addEventListener('click', () => {
            this.installApp();
        });
        
        // Install prompt
        document.getElementById('installPromptButton').addEventListener('click', () => {
            this.installApp();
        });
        
        document.getElementById('dismissInstallPrompt').addEventListener('click', () => {
            this.hideInstallPrompt();
        });
        
        // Update notification handlers
        document.getElementById('updateAppButton').addEventListener('click', () => {
            this.updateApp();
        });
        
        document.getElementById('dismissUpdateButton').addEventListener('click', () => {
            this.dismissUpdateNotification();
        });
        
        // Handle notification permission change
        document.getElementById('settingsEnablePushNotifications').addEventListener('change', async (e) => {
            if (e.target.checked) {
                const permission = await this.requestNotificationPermission();
                if (permission === 'granted') {
                    this.showToast(this.translate('notifications_enabled'));
                    this.startNotificationChecker();
                } else {
                    e.target.checked = false;
                    this.showToast(this.translate('notification_permission_denied'));
                }
            }
        });
        
        // Close modals when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    this.closeModal(modal.id);
                }
            });
        });
        
        // Handle back button on mobile
        window.addEventListener('popstate', () => {
            this.handleBackButton();
        });
        
        // Before install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            this.deferredPrompt = e;
            this.showInstallButton();
        });
        
        // Online/Offline detection
        window.addEventListener('online', () => {
            this.updateOnlineStatus();
        });
        
        window.addEventListener('offline', () => {
            this.updateOnlineStatus();
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Only trigger if no modal is open and not in an input field
            if (document.querySelector('.modal.show') || e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }
            
            // Ctrl/Cmd + N = New Client
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                this.openModal('addClientModal');
            }
            
            // Ctrl/Cmd + A = New Appointment
            if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
                e.preventDefault();
                this.openModal('addAppointmentModal');
            }
            
            // Ctrl/Cmd + I = New Inventory Item
            if ((e.ctrlKey || e.metaKey) && e.key === 'i') {
                e.preventDefault();
                this.openModal('addInventoryModal');
            }
        });
    }
    
    setupLanguage() {
        const savedLanguage = localStorage.getItem('hairsalon_language') || 'en';
        this.changeLanguage(savedLanguage);
        document.getElementById('languageSelect').value = savedLanguage;
    }
    
    changeLanguage(lang) {
        this.currentLanguage = lang;
        localStorage.setItem('hairsalon_language', lang);
        this.translatePage();
        
        // Update all dynamic content that might have been rendered
        this.updateDashboard();
        this.renderClients();
        this.renderAppointments();
        this.renderUpcomingSessions();
        this.renderInventory();
        this.renderCalendar();
    }
    
    translatePage() {
        // Translate text content
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            const translation = this.translate(key);
            if (translation !== key) {
                element.textContent = translation;
            }
        });
        
        // Translate placeholders
        document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
            const key = element.getAttribute('data-i18n-placeholder');
            const translation = this.translate(key);
            if (translation !== key) {
                element.placeholder = translation;
            }
        });
    }
    
    translate(key) {
        return this.translations[this.currentLanguage]?.[key] || key;
    }
    
    showSection(sectionId, skipHistory = false) {
        // Hide all sections
        document.querySelectorAll('.section').forEach(section => {
            section.classList.remove('active');
        });
        
        // Remove active class from all nav links
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
        });
        
        // Remove active class from all bottom nav items
        document.querySelectorAll('.bottom-nav-item').forEach(item => {
            item.classList.remove('active');
        });
        
        // Show selected section
        document.getElementById(sectionId).classList.add('active');
        
        // Add active class to clicked nav link (both sidebar and bottom nav)
        document.querySelectorAll(`[data-section="${sectionId}"]`).forEach(link => {
            link.classList.add('active');
        });
        
        // Push history state for navigation (unless we're navigating via back button)
        if (!skipHistory && sectionId !== this.currentSection) {
            history.pushState({ section: sectionId }, '', `#${sectionId}`);
        }
        
        // Update current section
        this.currentSection = sectionId;
        
        // Update section-specific content
        switch(sectionId) {
            case 'dashboard':
                this.updateDashboard();
                break;
            case 'clients':
                this.renderClients();
                break;
            case 'appointments':
                this.renderAppointments();
                break;
            case 'upcoming':
                this.renderUpcomingSessions();
                break;
            case 'inventory':
                this.renderInventory();
                break;
            case 'calendar':
                this.renderCalendar();
                break;
            case 'settings':
                this.loadSettings();
                break;
        }
    }
    
    /**
     * Setup back button prevention to keep app from closing on Android
     */
    setupBackButtonPrevention() {
        // Push initial state to history
        history.pushState({ section: 'dashboard' }, '', '#dashboard');
    }
    
    /**
     * Handle back button press
     */
    handleBackButton() {
        // First, check if any modals are open and close them
        const openModal = document.querySelector('.modal.show');
        if (openModal) {
            this.closeAllModals();
            // Push current section back to history so we stay in the app
            history.pushState({ section: this.currentSection }, '', `#${this.currentSection}`);
            return;
        }
        
        // If we're not on dashboard, navigate to dashboard
        if (this.currentSection !== 'dashboard') {
            this.showSection('dashboard', true);
            return;
        }
        
        // If we're on dashboard, push state again to prevent app from closing
        history.pushState({ section: 'dashboard' }, '', '#dashboard');
    }
    
    updateDashboard() {
        // Update stats
        document.getElementById('totalClients').textContent = this.clients.length;
        document.getElementById('totalAppointments').textContent = this.appointments.length;
        
        const upcoming = this.appointments.filter(apt => 
            new Date(apt.date + ' ' + apt.time) > new Date()
        ).length;
        document.getElementById('upcomingAppointments').textContent = upcoming;
        
        const lowStock = this.inventory.filter(item => item.quantity <= item.lowStock).length;
        document.getElementById('lowStockItems').textContent = lowStock;
        
        // Calculate and update revenue stats
        const currentDate = new Date();
        const currentMonth = currentDate.getMonth();
        const currentYear = currentDate.getFullYear();
        
        // Calculate month revenue
        const monthRevenue = this.appointments
            .filter(apt => {
                const aptDate = new Date(apt.date);
                return aptDate.getMonth() === currentMonth && aptDate.getFullYear() === currentYear;
            })
            .reduce((total, apt) => total + apt.price, 0);
        
        // Calculate year revenue
        const yearRevenue = this.appointments
            .filter(apt => {
                const aptDate = new Date(apt.date);
                return aptDate.getFullYear() === currentYear;
            })
            .reduce((total, apt) => total + apt.price, 0);
        
        // Update revenue displays - NO CURRENCY SYMBOLS
        document.getElementById('monthRevenue').textContent = monthRevenue.toFixed(2);
        document.getElementById('yearRevenue').textContent = yearRevenue.toFixed(2);
        
        // Update recent appointments
        this.renderRecentAppointments();
    }
    
    renderRecentAppointments() {
        const container = document.getElementById('recentAppointmentsList');
        const recentAppointments = this.appointments
            .sort((a, b) => new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time))
            .slice(0, 5);
        
        if (recentAppointments.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-calendar-times"></i>
                    <h3 data-i18n="no_appointments_yet">${this.translate('no_appointments_yet')}</h3>
                    <p data-i18n="schedule_first_appointment">${this.translate('schedule_first_appointment')}</p>
                    <button class="btn btn-primary" onclick="HairSalonApp.openModal('addAppointmentModal')">
                        <i class="fas fa-plus"></i> <span data-i18n="add_first_appointment">${this.translate('add_first_appointment')}</span>
                    </button>
                </div>
            `;
            this.translatePage();
            return;
        }
        
        container.innerHTML = '';
        recentAppointments.forEach(appointment => {
            const client = this.clients.find(c => c.id === appointment.clientId);
            const appointmentElement = document.createElement('div');
            appointmentElement.className = 'data-item appointment-item';
            
            appointmentElement.innerHTML = `
                <div class="data-item-content">
                    <h4>${appointment.service}</h4>
                    <p><i class="fas fa-user"></i> ${client ? client.name : 'Unknown Client'}</p>
                    <p><i class="fas fa-calendar"></i> ${new Date(appointment.date).toLocaleDateString()} at ${appointment.time}</p>
                    <p><i class="fas fa-tag"></i> ${appointment.price.toFixed(2)}</p>
                    ${appointment.notes ? `<p><i class="fas fa-sticky-note"></i> ${appointment.notes}</p>` : ''}
                </div>
                <div class="data-item-actions">
                    <button class="btn btn-outline btn-sm" onclick="HairSalonApp.editAppointment('${appointment.id}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="HairSalonApp.deleteAppointment('${appointment.id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(appointmentElement);
        });
    }
    
    renderClients(searchQuery = '') {
        const container = document.getElementById('clientsList');
        
        // Filter clients based on search query
        let filteredClients = this.clients;
        if (searchQuery) {
            filteredClients = this.clients.filter(client => 
                client.name.toLowerCase().includes(searchQuery) ||
                (client.phone && client.phone.toLowerCase().includes(searchQuery)) ||
                (client.email && client.email.toLowerCase().includes(searchQuery))
            );
        }
        
        if (this.clients.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-users"></i>
                    <h3 data-i18n="no_clients_yet">${this.translate('no_clients_yet')}</h3>
                    <p data-i18n="build_client_database">${this.translate('build_client_database')}</p>
                    <button class="btn btn-primary" onclick="HairSalonApp.openModal('addClientModal')">
                        <i class="fas fa-plus"></i> <span data-i18n="add_first_client">${this.translate('add_first_client')}</span>
                    </button>
                </div>
            `;
            this.translatePage();
            return;
        }
        
        if (filteredClients.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-search"></i>
                    <h3>${this.translate('no_clients_yet')}</h3>
                    <p>${this.translate('try_adjusting_search')}</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = '';
        // Render each client item with full accessibility support
        // Future enhancement: Add multi-select checkboxes for bulk delete operations
        filteredClients.forEach(client => {
            const clientElement = document.createElement('div');
            clientElement.className = 'data-item';
            clientElement.setAttribute('data-client-id', client.id);
            
            clientElement.innerHTML = `
                <div class="data-item-content">
                    <h4>${client.name}</h4>
                    ${client.phone ? `<p><i class="fas fa-phone" aria-hidden="true"></i> <span class="sr-only">${this.translate('phone')}:</span> ${client.phone}</p>` : ''}
                    ${client.email ? `<p><i class="fas fa-envelope" aria-hidden="true"></i> <span class="sr-only">${this.translate('email')}:</span> ${client.email}</p>` : ''}
                    ${client.notes ? `<p><i class="fas fa-sticky-note" aria-hidden="true"></i> <span class="sr-only">${this.translate('notes')}:</span> ${client.notes}</p>` : ''}
                </div>
                <div class="data-item-actions" role="group" aria-label="${this.translate('client_actions')}">
                    <button class="btn btn-outline btn-sm" 
                            onclick="HairSalonApp.editClient('${client.id}')"
                            aria-label="${this.translate('edit_client')}: ${client.name}"
                            title="${this.translate('edit_client')}">
                        <i class="fas fa-edit" aria-hidden="true"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" 
                            onclick="HairSalonApp.deleteClient('${client.id}')"
                            aria-label="${this.translate('delete_client')}: ${client.name}"
                            title="${this.translate('delete_client')}">
                        <i class="fas fa-trash" aria-hidden="true"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(clientElement);
        });
    }
    
    renderAppointments(searchQuery = '') {
        const container = document.getElementById('appointmentsList');
        
        // Filter appointments based on search query
        let filteredAppointments = this.appointments;
        if (searchQuery) {
            filteredAppointments = this.appointments.filter(apt => {
                const client = this.clients.find(c => c.id === apt.clientId);
                const clientName = client ? client.name.toLowerCase() : '';
                return apt.service.toLowerCase().includes(searchQuery) ||
                       clientName.includes(searchQuery) ||
                       apt.date.includes(searchQuery);
            });
        }
        
        if (this.appointments.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-calendar-times"></i>
                    <h3 data-i18n="no_appointments_yet">${this.translate('no_appointments_yet')}</h3>
                    <p data-i18n="schedule_first_appointment">${this.translate('schedule_first_appointment')}</p>
                    <button class="btn btn-primary" onclick="HairSalonApp.openModal('addAppointmentModal')">
                        <i class="fas fa-plus"></i> <span data-i18n="add_first_appointment">${this.translate('add_first_appointment')}</span>
                    </button>
                </div>
            `;
            this.translatePage();
            return;
        }
        
        if (filteredAppointments.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-search"></i>
                    <h3>${this.translate('no_appointments_yet')}</h3>
                    <p>${this.translate('try_adjusting_search')}</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = '';
        filteredAppointments
            .sort((a, b) => new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time))
            .forEach(appointment => {
                const client = this.clients.find(c => c.id === appointment.clientId);
                const appointmentElement = document.createElement('div');
                appointmentElement.className = 'data-item appointment-item';
                
                appointmentElement.innerHTML = `
                    <div class="data-item-content">
                        <h4>${appointment.service}</h4>
                        <p><i class="fas fa-user"></i> ${client ? client.name : 'Unknown Client'}</p>
                        <p><i class="fas fa-calendar"></i> ${new Date(appointment.date).toLocaleDateString()} at ${appointment.time}</p>
                        <p><i class="fas fa-tag"></i> ${appointment.price.toFixed(2)}</p>
                        ${appointment.notes ? `<p><i class="fas fa-sticky-note"></i> ${appointment.notes}</p>` : ''}
                        ${appointment.inventoryUsage && appointment.inventoryUsage.length > 0 ? 
                            `<p><i class="fas fa-box-open"></i> ${this.translate('products_used_label')} ${appointment.inventoryUsage.map(item => `${item.itemName} (${item.quantity})`).join(', ')}</p>` : ''}
                    </div>
                    <div class="data-item-actions">
                        <button class="btn btn-outline btn-sm" onclick="HairSalonApp.editAppointment('${appointment.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="HairSalonApp.deleteAppointment('${appointment.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(appointmentElement);
            });
    }
    
    renderUpcomingSessions() {
        const container = document.getElementById('upcomingSessionsList');
        const upcomingAppointments = this.appointments
            .filter(apt => new Date(apt.date + ' ' + apt.time) > new Date())
            .sort((a, b) => new Date(a.date + ' ' + a.time) - new Date(b.date + ' ' + b.time));
        
        if (upcomingAppointments.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-clock"></i>
                    <h3 data-i18n="no_upcoming_sessions">${this.translate('no_upcoming_sessions')}</h3>
                    <button class="btn btn-primary" onclick="HairSalonApp.openModal('addAppointmentModal')">
                        <i class="fas fa-plus"></i> <span data-i18n="schedule_appointment">${this.translate('schedule_appointment')}</span>
                    </button>
                </div>
            `;
            this.translatePage();
            return;
        }
        
        container.innerHTML = '';
        upcomingAppointments.forEach(appointment => {
            const client = this.clients.find(c => c.id === appointment.clientId);
            const appointmentElement = document.createElement('div');
            appointmentElement.className = 'data-item appointment-item';
            
            appointmentElement.innerHTML = `
                <div class="data-item-content">
                    <h4>${appointment.service}</h4>
                    <p><i class="fas fa-user"></i> ${client ? client.name : 'Unknown Client'}</p>
                    <p><i class="fas fa-calendar"></i> ${new Date(appointment.date).toLocaleDateString()} at ${appointment.time}</p>
                    <p><i class="fas fa-tag"></i> ${appointment.price.toFixed(2)}</p>
                    ${appointment.notes ? `<p><i class="fas fa-sticky-note"></i> ${appointment.notes}</p>` : ''}
                    ${appointment.inventoryUsage && appointment.inventoryUsage.length > 0 ? 
                        `<p><i class="fas fa-box-open"></i> ${this.translate('products_used_label')} ${appointment.inventoryUsage.map(item => `${item.itemName} (${item.quantity})`).join(', ')}</p>` : ''}
                </div>
                <div class="data-item-actions">
                    <button class="btn btn-outline btn-sm" onclick="HairSalonApp.editAppointment('${appointment.id}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="HairSalonApp.deleteAppointment('${appointment.id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(appointmentElement);
        });
    }
    
    renderInventory(searchQuery = '', category = 'all') {
        const container = document.getElementById('inventoryList');
        
        // Filter inventory based on category and search query
        let filteredInventory = this.inventory;
        
        // Apply category filter
        if (category !== 'all') {
            filteredInventory = filteredInventory.filter(item => item.category === category);
        }
        
        // Apply search filter
        if (searchQuery) {
            filteredInventory = filteredInventory.filter(item => 
                item.name.toLowerCase().includes(searchQuery) ||
                item.category.toLowerCase().includes(searchQuery)
            );
        }
        
        if (this.inventory.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-boxes"></i>
                    <h3 data-i18n="no_inventory_items">${this.translate('no_inventory_items')}</h3>
                    <p data-i18n="add_inventory_items">${this.translate('add_inventory_items')}</p>
                    <button class="btn btn-primary" onclick="HairSalonApp.openModal('addInventoryModal')">
                        <i class="fas fa-plus"></i> <span data-i18n="add_first_item">${this.translate('add_first_item')}</span>
                    </button>
                </div>
            `;
            this.translatePage();
            return;
        }
        
        if (filteredInventory.length === 0) {
            const message = category !== 'all' 
                ? `${this.translate('no_items_found_in')} ${this.translate(category)} ${this.translate('category_word')}` 
                : this.translate('no_inventory_items');
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-search"></i>
                    <h3>${message}</h3>
                    <p>${this.translate('try_adjusting_search_category')}</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = '';
        filteredInventory.forEach(item => {
            const isLowStock = item.quantity <= item.lowStock;
            const itemElement = document.createElement('div');
            itemElement.className = `data-item inventory-item ${isLowStock ? 'low-stock' : ''}`;
            
            itemElement.innerHTML = `
                <div class="data-item-content">
                    <h4>${item.name}</h4>
                    <p><i class="fas fa-tag"></i> ${this.translate(item.category)}</p>
                    <p><i class="fas fa-box"></i> ${item.quantity} units</p>
                    <p><i class="fas fa-exclamation-triangle"></i> Low stock alert: ${item.lowStock} units</p>
                    ${item.notes ? `<p><i class="fas fa-sticky-note"></i> ${item.notes}</p>` : ''}
                    ${isLowStock ? `<span style="color: var(--danger);"><i class="fas fa-exclamation-circle"></i> ${this.translate('low_stock_warning')}</span>` : ''}
                </div>
                <div class="data-item-actions">
                    <button class="btn btn-outline btn-sm" onclick="HairSalonApp.editInventoryItem('${item.id}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline btn-sm" onclick="HairSalonApp.viewUsageHistory('${item.id}')">
                        <i class="fas fa-history"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="HairSalonApp.deleteInventoryItem('${item.id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(itemElement);
        });
    }
    
    renderCalendar() {
        const monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"];
        
        const currentMonth = this.currentDate.getMonth();
        const currentYear = this.currentDate.getFullYear();
        
        // Update month/year display
        document.getElementById('currentMonthYear').textContent = 
            `${monthNames[currentMonth]} ${currentYear}`;
        
        // Get first day of month and number of days
        const firstDay = new Date(currentYear, currentMonth, 1);
        const lastDay = new Date(currentYear, currentMonth + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startingDay = firstDay.getDay();
        
        const calendarGrid = document.getElementById('calendarGrid');
        calendarGrid.innerHTML = '';
        
        // Add day headers
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        dayNames.forEach(day => {
            const dayHeader = document.createElement('div');
            dayHeader.className = 'calendar-day-header';
            dayHeader.textContent = day;
            calendarGrid.appendChild(dayHeader);
        });
        
        // Add empty cells for days before the first day of the month
        for (let i = 0; i < startingDay; i++) {
            const emptyDay = document.createElement('div');
            emptyDay.className = 'calendar-day other-month';
            calendarGrid.appendChild(emptyDay);
        }
        
        // Add days of the month
        const today = new Date();
        for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            
            // Check if this is today
            if (day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                dayElement.classList.add('today');
            }
            
            // Check for appointments on this day
            const currentDate = new Date(currentYear, currentMonth, day);
            const dateString = currentDate.toISOString().split('T')[0];
            const dayAppointments = this.appointments.filter(apt => apt.date === dateString);
            
            if (dayAppointments.length > 0) {
                dayElement.classList.add('has-events');
            }
            
            dayElement.innerHTML = `
                <div class="calendar-day-number">${day}</div>
                <div class="calendar-events">
                    ${dayAppointments.slice(0, 3).map(apt => {
                        const client = this.clients.find(c => c.id === apt.clientId);
                        return `<div class="calendar-event" title="${client ? client.name : 'Unknown'}: ${apt.service}">${apt.service}</div>`;
                    }).join('')}
                </div>
            `;
            
            // Add click event - show appointments if they exist, otherwise create new
            dayElement.addEventListener('click', () => {
                if (dayAppointments.length > 0) {
                    this.showDateAppointments(dateString, dayAppointments);
                } else {
                    this.createAppointmentForDate(dateString);
                }
            });
            
            // Add tooltip
            if (dayAppointments.length > 0) {
                dayElement.title = this.translate('click_to_view_appointments');
            } else {
                dayElement.title = this.translate('click_to_create_session');
            }
            
            calendarGrid.appendChild(dayElement);
        }
    }
    
    createAppointmentForDate(dateString) {
        this.selectedCalendarDate = dateString;
        this.openModal('addAppointmentModal');
        
        // Set the date in the appointment form
        document.getElementById('appointmentDate').value = dateString;
        
        // Update modal title to show selected date
        const modalTitle = document.querySelector('#addAppointmentModal .modal-title span');
        modalTitle.textContent = `${this.translate('create_appointment_for')} ${new Date(dateString).toLocaleDateString()}`;
    }
    
    showDateAppointments(dateString, appointments) {
        this.selectedCalendarDate = dateString;
        
        // Update modal title
        const title = document.getElementById('dateAppointmentsTitle');
        title.textContent = `${this.translate('appointments_for')} ${new Date(dateString).toLocaleDateString()}`;
        
        // Render appointments
        const container = document.getElementById('dateAppointmentsList');
        container.innerHTML = '';
        
        appointments
            .sort((a, b) => a.time.localeCompare(b.time))
            .forEach(appointment => {
                const client = this.clients.find(c => c.id === appointment.clientId);
                const appointmentElement = document.createElement('div');
                appointmentElement.className = 'data-item appointment-item';
                
                appointmentElement.innerHTML = `
                    <div class="data-item-content">
                        <h4>${appointment.service}</h4>
                        <p><i class="fas fa-user"></i> ${client ? client.name : 'Unknown Client'}</p>
                        <p><i class="fas fa-clock"></i> ${appointment.time}</p>
                        <p><i class="fas fa-tag"></i> ${appointment.price.toFixed(2)}</p>
                        ${appointment.notes ? `<p><i class="fas fa-sticky-note"></i> ${appointment.notes}</p>` : ''}
                        ${appointment.inventoryUsage && appointment.inventoryUsage.length > 0 ? 
                            `<p><i class="fas fa-box-open"></i> ${this.translate('products_used_label')} ${appointment.inventoryUsage.map(item => `${item.itemName} (${item.quantity})`).join(', ')}</p>` : ''}
                    </div>
                    <div class="data-item-actions">
                        <button class="btn btn-outline btn-sm" onclick="HairSalonApp.editAppointment('${appointment.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="HairSalonApp.deleteAppointment('${appointment.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(appointmentElement);
            });
        
        // Open the modal
        this.openModal('viewDateAppointmentsModal');
    }
    
    addAppointmentForSelectedDate() {
        // Close the date appointments modal
        this.closeModal('viewDateAppointmentsModal');
        // Open the add appointment modal with the selected date
        this.createAppointmentForDate(this.selectedCalendarDate);
    }
    
    openModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.add('show');
        document.body.style.overflow = 'hidden';
        
        // Populate client dropdown for appointment modal
        if (modalId === 'addAppointmentModal') {
            this.populateClientDropdown();
            this.populateInventoryForAppointment();
            
            // Set default time and date only when creating new appointment (not editing)
            if (!this.editingAppointmentId) {
                // Set default time to current time + 1 hour
                const now = new Date();
                now.setHours(now.getHours() + 1);
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                document.getElementById('appointmentTime').value = `${hours}:${minutes}`;
                
                // Set today's date as default if no date selected from calendar
                if (!this.selectedCalendarDate) {
                    const today = new Date().toISOString().split('T')[0];
                    document.getElementById('appointmentDate').value = today;
                }
            }
        }
        
        // Focus on first input field
        setTimeout(() => {
            const firstInput = modal.querySelector('input:not([type="hidden"]), textarea, select');
            if (firstInput) {
                firstInput.focus();
            }
        }, 100);
        
        // Trap focus within modal
        this.trapFocus(modal);
    }
    
    closeModal(modalId) {
        document.getElementById(modalId).classList.remove('show');
        document.body.style.overflow = 'auto';
        this.resetForms();
    }
    
    closeAllModals() {
        document.querySelectorAll('.modal').forEach(modal => {
            modal.classList.remove('show');
        });
        document.body.style.overflow = 'auto';
        this.resetForms();
    }
    
    resetForms() {
        document.getElementById('addClientForm').reset();
        document.getElementById('addAppointmentForm').reset();
        document.getElementById('addInventoryForm').reset();
        this.editingClientId = null;
        this.editingInventoryId = null;
        this.editingAppointmentId = null;
        this.selectedCalendarDate = null;
        
        // Reset inventory selection for appointment modal
        const inventoryGrid = document.getElementById('appointmentInventoryItems');
        if (inventoryGrid) {
            inventoryGrid.innerHTML = '';
        }
        
        // Reset modal titles and buttons
        this.translatePage();
    }
    
    populateClientDropdown() {
        const dropdown = document.getElementById('appointmentClient');
        dropdown.innerHTML = '<option value="" data-i18n="select_client">Select Client</option>';
        
        this.clients.forEach(client => {
            const option = document.createElement('option');
            option.value = client.id;
            option.textContent = client.name;
            dropdown.appendChild(option);
        });
        
        this.translatePage();
    }
    
    populateInventoryForAppointment() {
        const container = document.getElementById('appointmentInventoryItems');
        container.innerHTML = '';
        
        if (this.inventory.length === 0) {
            container.innerHTML = `<p>${this.translate('no_inventory_available')}</p>`;
            return;
        }
        
        this.inventory.forEach(item => {
            const isLowStock = item.quantity <= item.lowStock;
            const itemElement = document.createElement('div');
            itemElement.className = `inventory-item-select ${isLowStock ? 'low-stock' : ''}`;
            itemElement.dataset.id = item.id;
            
            itemElement.innerHTML = `
                <h4>${item.name}</h4>
                <p>${this.translate(item.category)}</p>
                <p>${this.translate('available_units')}: ${item.quantity} ${this.translate('units')}</p>
                <div class="inventory-quantity-input">
                    <label>${this.translate('qty_label')}</label>
                    <input type="number" min="0" max="${item.quantity}" value="0" data-id="${item.id}">
                </div>
            `;
            
            container.appendChild(itemElement);
        });
    }
    
    saveClient() {
        const name = this.sanitizeInput(document.getElementById('clientName').value.trim());
        const phone = this.sanitizeInput(document.getElementById('clientPhone').value.trim());
        const email = this.sanitizeInput(document.getElementById('clientEmail').value.trim());
        const notes = this.sanitizeInput(document.getElementById('clientNotes').value.trim());
        
        // Validation
        if (!name) {
            this.showToast(this.translate('please_enter_client_name'));
            return;
        }
        
        if (phone && !this.validatePhone(phone)) {
            this.showToast(this.translate('please_enter_valid_phone'));
            return;
        }
        
        if (email && !this.validateEmail(email)) {
            this.showToast(this.translate('please_enter_valid_email'));
            return;
        }
        
        // Disable save button during save operation
        const saveButton = document.querySelector('#addClientForm button[type="submit"]');
        const originalButtonText = saveButton.innerHTML;
        saveButton.disabled = true;
        saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        
        try {
            if (this.editingClientId) {
                // Update existing client
                const clientIndex = this.clients.findIndex(c => c.id === this.editingClientId);
                if (clientIndex !== -1) {
                    this.clients[clientIndex] = {
                        ...this.clients[clientIndex],
                        name,
                        phone,
                        email,
                        notes
                    };
                }
                this.showToast(this.translate('client_updated'));
            } else {
                // Add new client
                const newClient = {
                    id: this.generateId(),
                    name,
                    phone,
                    email,
                    notes,
                    createdAt: new Date().toISOString()
                };
                this.clients.push(newClient);
                this.showToast(this.translate('client_saved'));
            }
            
            this.saveToLocalStorage();
            this.closeModal('addClientModal');
            this.renderClients();
            this.updateDashboard();
        } catch (error) {
            console.error('Error saving client:', error);
            this.showToast('Failed to save client. Please try again.');
        } finally {
            // Re-enable save button
            saveButton.disabled = false;
            saveButton.innerHTML = originalButtonText;
        }
    }
    
    saveAppointment() {
        const clientId = document.getElementById('appointmentClient').value;
        const date = document.getElementById('appointmentDate').value;
        const time = document.getElementById('appointmentTime').value;
        const service = this.sanitizeInput(document.getElementById('appointmentService').value.trim());
        const priceValue = document.getElementById('appointmentPrice').value;
        const price = priceValue ? parseFloat(priceValue) : 0;
        const notes = this.sanitizeInput(document.getElementById('appointmentNotes').value.trim());
        
        // Validation
        if (!date) {
            this.showToast(this.translate('please_select_date'));
            return;
        }
        
        if (!time) {
            this.showToast(this.translate('please_select_time'));
            return;
        }
        
        if (!service) {
            this.showToast(this.translate('please_enter_service'));
            return;
        }
        
        if (price && !this.validatePrice(price)) {
            this.showToast(this.translate('please_enter_valid_price'));
            return;
        }
        
        if (!this.validateDateTime(date, time)) {
            this.showToast(this.translate('please_select_valid_date'));
            return;
        }
        
        // Disable save button during save operation
        const saveButton = document.querySelector('#addAppointmentForm button[type="submit"]');
        const originalButtonText = saveButton.innerHTML;
        saveButton.disabled = true;
        saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        
        try {
            // When editing, temporarily restore old inventory before validation
            let oldAppointment = null;
            if (this.editingAppointmentId) {
                const appointmentIndex = this.appointments.findIndex(a => a.id === this.editingAppointmentId);
                if (appointmentIndex !== -1) {
                    oldAppointment = this.appointments[appointmentIndex];
                    
                    // Temporarily restore previously used inventory for proper validation
                    if (oldAppointment.inventoryUsage && oldAppointment.inventoryUsage.length > 0) {
                        oldAppointment.inventoryUsage.forEach(usage => {
                            const itemIndex = this.inventory.findIndex(i => i.id === usage.itemId);
                            if (itemIndex !== -1) {
                                this.inventory[itemIndex].quantity += usage.quantity;
                            }
                        });
                    }
                }
            }
            
            // Get inventory usage
            const inventoryUsage = [];
            const quantityInputs = document.querySelectorAll('#appointmentInventoryItems input[type="number"]');
            let hasInsufficientStock = false;
            
            quantityInputs.forEach(input => {
                const quantity = parseInt(input.value);
                if (quantity > 0) {
                    const itemId = input.dataset.id;
                    const item = this.inventory.find(i => i.id === itemId);
                    
                    if (item && quantity > item.quantity) {
                        hasInsufficientStock = true;
                        this.showToast(`${this.translate('insufficient_stock')}: ${item.name}`);
                        return;
                    }
                    
                    inventoryUsage.push({
                        itemId,
                        itemName: item.name,
                        quantity
                    });
                }
            });
            
            if (hasInsufficientStock) {
                // Restore inventory back to deducted state if we're editing
                if (oldAppointment && oldAppointment.inventoryUsage && oldAppointment.inventoryUsage.length > 0) {
                    oldAppointment.inventoryUsage.forEach(usage => {
                        const itemIndex = this.inventory.findIndex(i => i.id === usage.itemId);
                        if (itemIndex !== -1) {
                            this.inventory[itemIndex].quantity -= usage.quantity;
                        }
                    });
                }
                // Re-enable save button before returning
                saveButton.disabled = false;
                saveButton.innerHTML = originalButtonText;
                return; // Don't save appointment if insufficient stock
            }
            
            if (this.editingAppointmentId) {
                // Update existing appointment
                const appointmentIndex = this.appointments.findIndex(a => a.id === this.editingAppointmentId);
                if (appointmentIndex !== -1) {
                    // Remove usage history records for old inventory usage (already restored above)
                    if (oldAppointment.inventoryUsage && oldAppointment.inventoryUsage.length > 0) {
                        this.usageHistory = this.usageHistory.filter(record => record.appointmentId !== this.editingAppointmentId);
                    }
                    
                    // Update appointment
                    this.appointments[appointmentIndex] = {
                        ...this.appointments[appointmentIndex],
                        clientId,
                        date,
                        time,
                        service,
                        price,
                        notes,
                        inventoryUsage
                    };
                    
                    // Deduct new inventory usage
                    if (inventoryUsage.length > 0) {
                        this.deductInventory(inventoryUsage, this.editingAppointmentId);
                    }
                    
                    // Save to localStorage after inventory changes
                    this.saveToLocalStorage();
                }
                this.showToast(this.translate('appointment_updated'));
            } else {
                // Add new appointment
                const newAppointment = {
                    id: this.generateId(),
                    clientId,
                    date,
                    time,
                    service,
                    price,
                    notes,
                    inventoryUsage,
                    createdAt: new Date().toISOString()
                };
                this.appointments.push(newAppointment);
                this.showToast(this.translate('appointment_saved'));
                
                // Deduct inventory items
                this.deductInventory(inventoryUsage, newAppointment.id);
            }
            
            this.saveToLocalStorage();
            this.closeModal('addAppointmentModal');
            this.renderAppointments();
            this.renderUpcomingSessions();
            this.updateDashboard();
            this.renderCalendar();
            this.renderInventory();
        } catch (error) {
            console.error('Error saving appointment:', error);
            this.showToast('Failed to save appointment. Please try again.');
        } finally {
            // Re-enable save button
            saveButton.disabled = false;
            saveButton.innerHTML = originalButtonText;
        }
    }
    
    deductInventory(inventoryUsage, appointmentId) {
        const appointment = this.appointments.find(a => a.id === appointmentId);
        const client = this.clients.find(c => c.id === appointment.clientId);
        
        inventoryUsage.forEach(usage => {
            const itemIndex = this.inventory.findIndex(i => i.id === usage.itemId);
            if (itemIndex !== -1) {
                // Deduct the quantity
                this.inventory[itemIndex].quantity -= usage.quantity;
                
                // Record usage history
                const usageRecord = {
                    id: this.generateId(),
                    itemId: usage.itemId,
                    itemName: usage.itemName,
                    appointmentId: appointmentId,
                    clientName: client ? client.name : 'Unknown',
                    service: appointment.service,
                    quantity: usage.quantity,
                    date: new Date().toISOString()
                };
                
                this.usageHistory.push(usageRecord);
            }
        });
        
        this.saveToLocalStorage();
    }
    
    restoreInventory(inventoryUsage, appointmentId) {
        inventoryUsage.forEach(usage => {
            const itemIndex = this.inventory.findIndex(i => i.id === usage.itemId);
            if (itemIndex !== -1) {
                // Restore the quantity
                this.inventory[itemIndex].quantity += usage.quantity;
            }
        });
        
        // Remove usage history records for this appointment
        this.usageHistory = this.usageHistory.filter(record => record.appointmentId !== appointmentId);
        
        this.saveToLocalStorage();
    }
    
    saveInventoryItem() {
        const name = this.sanitizeInput(document.getElementById('inventoryName').value.trim());
        const category = document.getElementById('inventoryCategory').value;
        const quantity = parseInt(document.getElementById('inventoryQuantity').value);
        const lowStock = parseInt(document.getElementById('inventoryLowStock').value);
        const notes = this.sanitizeInput(document.getElementById('inventoryNotes').value.trim());
        
        // Validation
        if (!name) {
            this.showToast(this.translate('please_enter_item_name'));
            return;
        }
        
        if (isNaN(quantity) || quantity < 0) {
            this.showToast(this.translate('please_enter_valid_quantity'));
            return;
        }
        
        if (isNaN(lowStock) || lowStock < 0) {
            this.showToast(this.translate('please_enter_valid_threshold'));
            return;
        }
        
        // Disable save button during save operation
        const saveButton = document.querySelector('#addInventoryForm button[type="submit"]');
        const originalButtonText = saveButton.innerHTML;
        saveButton.disabled = true;
        saveButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        
        try {
            if (this.editingInventoryId) {
                // Update existing inventory item
                const inventoryIndex = this.inventory.findIndex(i => i.id === this.editingInventoryId);
                if (inventoryIndex !== -1) {
                    this.inventory[inventoryIndex] = {
                        ...this.inventory[inventoryIndex],
                        name,
                        category,
                        quantity,
                        lowStock,
                        notes
                    };
                }
                this.showToast(this.translate('inventory_updated'));
            } else {
                // Add new inventory item
                const newInventoryItem = {
                    id: this.generateId(),
                    name,
                    category,
                    quantity,
                    lowStock,
                    notes,
                    createdAt: new Date().toISOString()
                };
                this.inventory.push(newInventoryItem);
                this.showToast(this.translate('inventory_saved'));
            }
            
            this.saveToLocalStorage();
            this.closeModal('addInventoryModal');
            this.renderInventory();
            this.updateDashboard();
        } catch (error) {
            console.error('Error saving inventory item:', error);
            this.showToast('Failed to save inventory item. Please try again.');
        } finally {
            // Re-enable save button
            saveButton.disabled = false;
            saveButton.innerHTML = originalButtonText;
        }
    }
    
    editClient(clientId) {
        const client = this.clients.find(c => c.id === clientId);
        if (client) {
            document.getElementById('clientName').value = client.name;
            document.getElementById('clientPhone').value = client.phone;
            document.getElementById('clientEmail').value = client.email || '';
            document.getElementById('clientNotes').value = client.notes || '';
            
            this.editingClientId = clientId;
            this.openModal('addClientModal');
            
            // Update modal title
            const modalTitle = document.querySelector('#addClientModal .modal-title span');
            modalTitle.textContent = this.translate('edit_client');
            
            // Update button text
            const submitButton = document.querySelector('#addClientForm button[type="submit"]');
            submitButton.textContent = this.translate('update_client');
        }
    }
    
    editAppointment(appointmentId) {
        const appointment = this.appointments.find(a => a.id === appointmentId);
        if (appointment) {
            this.editingAppointmentId = appointmentId;
            this.openModal('addAppointmentModal');
            
            // Set form values after modal is opened
            document.getElementById('appointmentClient').value = appointment.clientId;
            document.getElementById('appointmentDate').value = appointment.date;
            document.getElementById('appointmentTime').value = appointment.time;
            document.getElementById('appointmentService').value = appointment.service;
            document.getElementById('appointmentPrice').value = appointment.price;
            document.getElementById('appointmentNotes').value = appointment.notes || '';
            
            // Pre-fill inventory usage after modal inventory items are populated
            if (appointment.inventoryUsage && appointment.inventoryUsage.length > 0) {
                appointment.inventoryUsage.forEach(usage => {
                    const input = document.querySelector(`#appointmentInventoryItems input[data-id="${usage.itemId}"]`);
                    if (input) {
                        input.value = usage.quantity;
                    }
                });
            }
            
            // Update modal title
            const modalTitle = document.querySelector('#addAppointmentModal .modal-title span');
            modalTitle.textContent = this.translate('edit_appointment');
            
            // Update button text
            const submitButton = document.querySelector('#addAppointmentForm button[type="submit"]');
            submitButton.textContent = this.translate('update_appointment');
        }
    }
    
    editInventoryItem(inventoryId) {
        const item = this.inventory.find(i => i.id === inventoryId);
        if (item) {
            document.getElementById('inventoryName').value = item.name;
            document.getElementById('inventoryCategory').value = item.category;
            document.getElementById('inventoryQuantity').value = item.quantity;
            document.getElementById('inventoryLowStock').value = item.lowStock;
            document.getElementById('inventoryNotes').value = item.notes || '';
            
            this.editingInventoryId = inventoryId;
            this.openModal('addInventoryModal');
            
            // Update modal title
            const modalTitle = document.querySelector('#addInventoryModal .modal-title span');
            modalTitle.textContent = this.translate('edit_inventory_item');
            
            // Update button text
            const submitButton = document.querySelector('#addInventoryForm button[type="submit"]');
            submitButton.textContent = this.translate('update_item');
        }
    }
    
    viewUsageHistory(inventoryId) {
        const item = this.inventory.find(i => i.id === inventoryId);
        if (!item) return;
        
        const container = document.getElementById('usageHistoryList');
        const itemUsage = this.usageHistory.filter(usage => usage.itemId === inventoryId);
        
        container.innerHTML = `
            <h4>${this.translate('view_usage_history')}: ${item.name}</h4>
        `;
        
        if (itemUsage.length === 0) {
            container.innerHTML += `
                <div class="empty-state">
                    <i class="fas fa-history"></i>
                    <h3>${this.translate('no_usage_history')}</h3>
                </div>
            `;
        } else {
            itemUsage.forEach(usage => {
                const usageElement = document.createElement('div');
                usageElement.className = 'usage-history-item';
                
                usageElement.innerHTML = `
                    <div class="usage-history-info">
                        <h4>${this.translate('used_in_appointment')}: ${usage.clientName}</h4>
                        <p>Service: ${usage.service}</p>
                        <p>Date: ${new Date(usage.date).toLocaleDateString()}</p>
                    </div>
                    <div class="usage-quantity">
                        -${usage.quantity} ${this.translate('quantity_used')}
                    </div>
                `;
                
                container.appendChild(usageElement);
            });
        }
        
        this.openModal('viewUsageModal');
    }
    
    /**
     * Delete a client with confirmation dialog and undo capability
     * @param {string} clientId - The unique identifier of the client to delete
     * 
     * Future enhancement: Support bulk delete by accepting an array of clientIds
     * and using Promise.all for concurrent deletion with a single undo action
     */
    deleteClient(clientId) {
        const client = this.clients.find(c => c.id === clientId);
        if (!client) {
            this.showToast(this.translate('client_not_found'));
            return;
        }
        
        this.showConfirmDialog(
            this.translate('delete_client'),
            `${this.translate('confirm_delete_client')} ${client.name}?`,
            () => {
                this.performClientDeletion(client, clientId);
            }
        );
    }
    
    /**
     * Perform the actual client deletion with undo support
     * @param {Object} client - The client object to delete
     * @param {string} clientId - The client ID
     */
    performClientDeletion(client, clientId) {
        try {
            // Store the client for potential undo
            const deletedClient = { ...client };
            const clientIndex = this.clients.findIndex(c => c.id === clientId);
            
            // Remove the client from the array
            this.clients = this.clients.filter(c => c.id !== clientId);
            
            // Remove from DOM immediately for better UX
            const clientElement = document.querySelector(`[data-client-id="${clientId}"]`);
            if (clientElement) {
                clientElement.style.transition = 'opacity 0.3s, transform 0.3s';
                clientElement.style.opacity = '0';
                clientElement.style.transform = 'translateX(-20px)';
                setTimeout(() => {
                    clientElement.remove();
                    // Re-render if the list is now empty
                    if (this.clients.length === 0) {
                        this.renderClients();
                    }
                }, 300);
            }
            
            // Save to localStorage
            this.saveToLocalStorage();
            
            // Update dashboard metrics
            this.updateDashboard();
            
            // Show undo toast with restore option
            this.showUndoToast(
                this.translate('client_deleted'),
                () => {
                    this.restoreClient(deletedClient, clientIndex);
                }
            );
            
        } catch (error) {
            console.error('Error deleting client:', error);
            this.showToast(this.translate('delete_failed'));
            // Re-render to restore consistent state
            this.renderClients();
        }
    }
    
    /**
     * Restore a deleted client (undo operation)
     * @param {Object} client - The client object to restore
     * @param {number} originalIndex - The original position in the array
     */
    restoreClient(client, originalIndex) {
        try {
            // Insert the client back at its original position (or at end if index is invalid)
            if (originalIndex >= 0 && originalIndex <= this.clients.length) {
                this.clients.splice(originalIndex, 0, client);
            } else {
                this.clients.push(client);
            }
            
            // Save to localStorage
            this.saveToLocalStorage();
            
            // Re-render the clients list
            this.renderClients();
            
            // Update dashboard metrics
            this.updateDashboard();
            
            // Show success toast
            this.showToast(this.translate('client_restored'));
            
        } catch (error) {
            console.error('Error restoring client:', error);
            this.showToast(this.translate('restore_failed'));
        }
    }
    
    /**
     * Show an undo toast notification with a restore button
     * @param {string} message - The message to display
     * @param {Function} onUndo - Callback function when undo is clicked
     * @param {number} duration - Duration in ms before auto-hide (default: 5000)
     */
    showUndoToast(message, onUndo, duration = 5000) {
        // Check if toasts are enabled in settings
        if (!this.settings.showToasts) {
            return;
        }
        
        const toast = document.getElementById('toast');
        
        // Clear any existing undo timeout
        if (this.undoTimeout) {
            clearTimeout(this.undoTimeout);
        }
        
        // Set up the undo toast content
        toast.className = 'toast undo-toast show';
        toast.innerHTML = `
            <span>${message}</span>
            <button class="undo-btn" aria-label="${this.translate('undo_delete')}">
                <i class="fas fa-undo" aria-hidden="true"></i> ${this.translate('undo')}
            </button>
        `;
        
        // Add click handler for undo button
        const undoBtn = toast.querySelector('.undo-btn');
        const handleUndo = () => {
            clearTimeout(this.undoTimeout);
            toast.classList.remove('show');
            toast.className = 'toast';
            toast.innerHTML = '';
            onUndo();
        };
        undoBtn.addEventListener('click', handleUndo);
        
        // Auto-hide after duration
        this.undoTimeout = setTimeout(() => {
            toast.classList.remove('show');
            // Reset toast to normal state
            setTimeout(() => {
                toast.className = 'toast';
                toast.innerHTML = '';
            }, 300);
        }, duration);
    }
    
    deleteAppointment(appointmentId) {
        const appointment = this.appointments.find(a => a.id === appointmentId);
        if (!appointment) return;
        
        this.showConfirmDialog(
            'Delete Appointment',
            `Are you sure you want to delete this appointment for ${appointment.service}? This action cannot be undone.`,
            () => {
                this.appointments = this.appointments.filter(a => a.id !== appointmentId);
                this.saveToLocalStorage();
                this.renderAppointments();
                this.renderUpcomingSessions();
                this.updateDashboard();
                this.renderCalendar();
                this.showToast(this.translate('item_deleted'));
            }
        );
    }
    
    deleteInventoryItem(inventoryId) {
        const item = this.inventory.find(i => i.id === inventoryId);
        if (!item) return;
        
        this.showConfirmDialog(
            'Delete Inventory Item',
            `Are you sure you want to delete ${item.name}? This action cannot be undone.`,
            () => {
                this.inventory = this.inventory.filter(i => i.id !== inventoryId);
                this.saveToLocalStorage();
                this.renderInventory();
                this.updateDashboard();
                this.showToast(this.translate('item_deleted'));
            }
        );
    }
    
    /**
     * Load settings into the form
     */
    loadSettings() {
        document.getElementById('settingsBusinessName').value = this.settings.businessName;
        document.getElementById('settingsCurrency').value = this.settings.currencySymbol;
        document.getElementById('settingsDefaultDuration').value = this.settings.defaultDuration;
        document.getElementById('settingsLowStockDefault').value = this.settings.lowStockDefault;
        document.getElementById('settingsOpenTime').value = this.settings.openTime;
        document.getElementById('settingsCloseTime').value = this.settings.closeTime;
        
        // Load working days
        document.getElementById('workingDayMon').checked = this.settings.workingDays.mon;
        document.getElementById('workingDayTue').checked = this.settings.workingDays.tue;
        document.getElementById('workingDayWed').checked = this.settings.workingDays.wed;
        document.getElementById('workingDayThu').checked = this.settings.workingDays.thu;
        document.getElementById('workingDayFri').checked = this.settings.workingDays.fri;
        document.getElementById('workingDaySat').checked = this.settings.workingDays.sat;
        document.getElementById('workingDaySun').checked = this.settings.workingDays.sun;
        
        // Load theme
        if (this.settings.theme === 'light') {
            document.getElementById('themeLight').checked = true;
            document.body.classList.add('light-mode');
        } else {
            document.getElementById('themeDark').checked = true;
            document.body.classList.remove('light-mode');
        }
        
        // Load time format
        document.getElementById('settingsTimeFormat').value = this.settings.timeFormat;
        
        // Load date format
        document.getElementById('settingsDateFormat').value = this.settings.dateFormat;
        
        // Load notification settings
        document.getElementById('settingsShowToasts').checked = this.settings.showToasts;
        document.getElementById('settingsEnablePushNotifications').checked = this.settings.enablePushNotifications || false;
    }
    
    /**
     * Save settings from the form
     */
    saveSettings() {
        this.settings.businessName = this.sanitizeInput(document.getElementById('settingsBusinessName').value.trim()) || 'HairSalon Pro';
        this.settings.currencySymbol = this.sanitizeInput(document.getElementById('settingsCurrency').value.trim());
        this.settings.defaultDuration = parseInt(document.getElementById('settingsDefaultDuration').value) || 60;
        this.settings.lowStockDefault = parseInt(document.getElementById('settingsLowStockDefault').value) || 5;
        this.settings.openTime = document.getElementById('settingsOpenTime').value;
        this.settings.closeTime = document.getElementById('settingsCloseTime').value;
        
        // Save working days
        this.settings.workingDays = {
            mon: document.getElementById('workingDayMon').checked,
            tue: document.getElementById('workingDayTue').checked,
            wed: document.getElementById('workingDayWed').checked,
            thu: document.getElementById('workingDayThu').checked,
            fri: document.getElementById('workingDayFri').checked,
            sat: document.getElementById('workingDaySat').checked,
            sun: document.getElementById('workingDaySun').checked
        };
        
        // Save theme
        const selectedTheme = document.querySelector('input[name="theme"]:checked').value;
        this.settings.theme = selectedTheme;
        
        // Apply theme immediately
        if (selectedTheme === 'light') {
            document.body.classList.add('light-mode');
        } else {
            document.body.classList.remove('light-mode');
        }
        
        // Save time format
        this.settings.timeFormat = document.getElementById('settingsTimeFormat').value;
        
        // Save date format
        this.settings.dateFormat = document.getElementById('settingsDateFormat').value;
        
        // Save notification settings
        this.settings.showToasts = document.getElementById('settingsShowToasts').checked;
        this.settings.enablePushNotifications = document.getElementById('settingsEnablePushNotifications').checked;
        
        // Start or stop notification checker based on setting
        if (this.settings.enablePushNotifications && Notification.permission === 'granted') {
            this.startNotificationChecker();
        }
        
        // Save to localStorage
        localStorage.setItem('hairsalon_settings', JSON.stringify(this.settings));
        
        // Update the app name in header if changed
        const headerLogo = document.querySelector('.app-header .logo span');
        if (headerLogo) {
            headerLogo.textContent = this.settings.businessName;
        }
        
        this.showToast(this.translate('settings_saved'));
    }
    
    /**
     * Reset settings to defaults
     */
    resetSettings() {
        this.showConfirmDialog(
            'Reset Settings',
            'Are you sure you want to reset all settings to their default values?',
            () => {
                this.settings = {
                    businessName: 'HairSalon Pro',
                    currencySymbol: '',
                    defaultDuration: 60,
                    lowStockDefault: 5,
                    openTime: '09:00',
                    closeTime: '18:00',
                    workingDays: {
                        mon: true,
                        tue: true,
                        wed: true,
                        thu: true,
                        fri: true,
                        sat: false,
                        sun: false
                    },
                    theme: 'dark',
                    timeFormat: '12',
                    dateFormat: 'MM/DD/YYYY',
                    showToasts: true,
                    enablePushNotifications: false
                };
                
                localStorage.setItem('hairsalon_settings', JSON.stringify(this.settings));
                this.loadSettings();
                
                // Update the app name in header
                const headerLogo = document.querySelector('.app-header .logo span');
                if (headerLogo) {
                    headerLogo.textContent = this.settings.businessName;
                }
                
                // Apply theme
                document.body.classList.remove('light-mode');
                
                this.showToast(this.translate('settings_reset'));
            }
        );
    }
    
    exportData(type) {
        let data, filename, headers;
        
        switch(type) {
            case 'clients':
                data = this.clients;
                filename = 'hairsalon_clients.csv';
                headers = ['Name', 'Phone', 'Email', 'Notes', 'Created At'];
                break;
            case 'appointments':
                data = this.appointments.map(apt => {
                    const client = this.clients.find(c => c.id === apt.clientId);
                    return {
                        ...apt,
                        clientName: client ? client.name : 'Unknown'
                    };
                });
                filename = 'hairsalon_appointments.csv';
                headers = ['Client', 'Service', 'Date', 'Time', 'Price', 'Notes', 'Created At'];
                break;
            case 'inventory':
                data = this.inventory;
                filename = 'hairsalon_inventory.csv';
                headers = ['Name', 'Category', 'Quantity', 'Low Stock Threshold', 'Notes', 'Created At'];
                break;
            default:
                return;
        }
        
        if (data.length === 0) {
            this.showToast(this.translate('no_data_to_export'));
            return;
        }
        
        let csvContent = headers.join(',') + '\n';
        
        data.forEach(item => {
            let row = [];
            switch(type) {
                case 'clients':
                    row = [item.name, item.phone, item.email || '', `"${item.notes || ''}"`, item.createdAt];
                    break;
                case 'appointments':
                    row = [item.clientName, item.service, item.date, item.time, item.price, `"${item.notes || ''}"`, item.createdAt];
                    break;
                case 'inventory':
                    row = [item.name, item.category, item.quantity, item.lowStock, `"${item.notes || ''}"`, item.createdAt];
                    break;
            }
            csvContent += row.join(',') + '\n';
        });
        
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        
        link.setAttribute('href', url);
        link.setAttribute('download', filename);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        this.showToast(this.translate('data_exported_successfully'));
    }
    
    /**
     * Backup all data to a JSON file
     */
    backupAllData() {
        const backupData = {
            version: '1.0',
            timestamp: new Date().toISOString(),
            clients: this.clients,
            appointments: this.appointments,
            inventory: this.inventory,
            usageHistory: this.usageHistory
        };
        
        const dataStr = JSON.stringify(backupData, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        const filename = `hairsalon_backup_${new Date().toISOString().split('T')[0]}.json`;
        
        link.setAttribute('href', url);
        link.setAttribute('download', filename);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        this.showToast(this.translate('backup_created_successfully'));
    }
    
    /**
     * Restore data from a backup file
     * @param {File} file - The backup file to restore from
     */
    restoreData(file) {
        if (!file) return;
        
        this.showConfirmDialog(
            'Restore Data',
            'This will replace all current data with the backup. Are you sure you want to continue? This action cannot be undone.',
            () => {
                this.performRestore(file);
            }
        );
    }
    
    /**
     * Perform the actual restore operation
     * @param {File} file - The backup file to restore from
     */
    performRestore(file) {
        
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const backupData = JSON.parse(e.target.result);
                
                // Validate backup data structure
                if (!backupData.clients || !backupData.appointments || !backupData.inventory) {
                    throw new Error('Invalid backup file format');
                }
                
                // Restore data
                this.clients = backupData.clients;
                this.appointments = backupData.appointments;
                this.inventory = backupData.inventory;
                this.usageHistory = backupData.usageHistory || [];
                
                // Save to localStorage
                this.saveToLocalStorage();
                
                // Refresh all views
                this.updateDashboard();
                this.renderClients();
                this.renderAppointments();
                this.renderUpcomingSessions();
                this.renderInventory();
                this.renderCalendar();
                
                this.showToast(this.translate('data_restored_successfully'));
            } catch (error) {
                console.error('Failed to restore backup:', error);
                this.showToast(this.translate('failed_to_restore'));
            }
        };
        reader.readAsText(file);
        
        // Reset the file input
        document.getElementById('restoreFileInput').value = '';
    }
    
    showToast(message) {
        // Check if toasts are enabled in settings
        if (!this.settings.showToasts) {
            return;
        }
        
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }
    
    generateId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }
    
    /**
     * Sanitize user input to prevent XSS attacks
     * @param {string} input - The input string to sanitize
     * @returns {string} - Sanitized string
     */
    sanitizeInput(input) {
        if (typeof input !== 'string') return input;
        const div = document.createElement('div');
        div.textContent = input;
        return div.innerHTML;
    }
    
    /**
     * Validate email format
     * @param {string} email - The email to validate
     * @returns {boolean} - True if valid
     */
    validateEmail(email) {
        if (!email) return true; // Email is optional
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }
    
    /**
     * Validate phone format
     * @param {string} phone - The phone to validate
     * @returns {boolean} - True if valid
     */
    validatePhone(phone) {
        if (!phone) return true; // Phone is now optional
        // Remove all non-digit characters except +
        const cleaned = phone.replace(/[^\d+]/g, '');
        // Must have at least 5 digits (min valid phone number)
        // and at most 15 digits (international standard)
        const digitsOnly = cleaned.replace(/\+/g, '');
        return digitsOnly.length >= 5 && digitsOnly.length <= 15;
    }
    
    /**
     * Validate price format
     * @param {number} price - The price to validate
     * @returns {boolean} - True if valid
     */
    validatePrice(price) {
        return !isNaN(price) && price >= 0;
    }
    
    /**
     * Validate date and time are valid
     * @param {string} date - Date in YYYY-MM-DD format
     * @param {string} time - Time in HH:MM format
     * @returns {boolean} - True if valid
     */
    validateDateTime(date, time) {
        if (!date || !time) return false;
        
        const appointmentDateTime = new Date(`${date}T${time}`);
        
        // Check if the date is valid (not NaN)
        if (isNaN(appointmentDateTime.getTime())) {
            return false;
        }
        
        // Allow all valid dates (including past dates for historical records and editing)
        return true;
    }
    
    /**
     * Filter clients by search query with debouncing
     * @param {string} query - The search query
     */
    filterClients(query) {
        if (this.clientSearchTimeout) {
            clearTimeout(this.clientSearchTimeout);
        }
        this.clientSearchTimeout = setTimeout(() => {
            this.renderClients(query.toLowerCase());
        }, 300);
    }
    
    /**
     * Filter appointments by search query with debouncing
     * @param {string} query - The search query
     */
    filterAppointments(query) {
        if (this.appointmentSearchTimeout) {
            clearTimeout(this.appointmentSearchTimeout);
        }
        this.appointmentSearchTimeout = setTimeout(() => {
            this.renderAppointments(query.toLowerCase());
        }, 300);
    }
    
    /**
     * Filter inventory by category
     * @param {string} category - The category to filter by
     */
    filterInventoryByCategory(category) {
        this.currentInventoryCategory = category;
        
        // Update active tab
        const tabs = document.querySelectorAll('.category-tab');
        tabs.forEach(tab => {
            if (tab.dataset.category === category) {
                tab.classList.add('active');
            } else {
                tab.classList.remove('active');
            }
        });
        
        // Clear search input and render with category filter
        const searchInput = document.getElementById('inventorySearch');
        if (searchInput) {
            searchInput.value = '';
        }
        
        this.renderInventory('', category);
    }
    
    /**
     * Filter inventory by search query with debouncing
     * @param {string} query - The search query
     */
    filterInventory(query) {
        if (this.inventorySearchTimeout) {
            clearTimeout(this.inventorySearchTimeout);
        }
        this.inventorySearchTimeout = setTimeout(() => {
            this.renderInventory(query.toLowerCase(), this.currentInventoryCategory);
        }, 300);
    }
    
    saveToLocalStorage() {
        try {
            localStorage.setItem('hairsalon_clients', JSON.stringify(this.clients));
            localStorage.setItem('hairsalon_appointments', JSON.stringify(this.appointments));
            localStorage.setItem('hairsalon_inventory', JSON.stringify(this.inventory));
            localStorage.setItem('hairsalon_usage_history', JSON.stringify(this.usageHistory));
        } catch (error) {
            console.error('Failed to save to localStorage:', error);
            // Check if it's a quota exceeded error
            if (error.name === 'QuotaExceededError' || error.code === 22) {
                this.showToast('Storage quota exceeded. Please export and clear old data.');
            } else {
                this.showToast(this.translate('failed_to_save'));
            }
        }
    }
    
    /**
     * Load data from localStorage with error handling
     */
    loadFromLocalStorage() {
        try {
            const clients = localStorage.getItem('hairsalon_clients');
            const appointments = localStorage.getItem('hairsalon_appointments');
            const inventory = localStorage.getItem('hairsalon_inventory');
            const usageHistory = localStorage.getItem('hairsalon_usage_history');
            const settings = localStorage.getItem('hairsalon_settings');
            
            if (clients) this.clients = JSON.parse(clients);
            if (appointments) this.appointments = JSON.parse(appointments);
            if (inventory) this.inventory = JSON.parse(inventory);
            if (usageHistory) this.usageHistory = JSON.parse(usageHistory);
            if (settings) this.settings = JSON.parse(settings);
        } catch (error) {
            console.error('Failed to load from localStorage:', error);
            this.showToast('Failed to load saved data. Starting fresh.');
        }
    }
    
    setupMobileMenu() {
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const sidebar = document.getElementById('sidebar');
        
        mobileMenuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('mobile-open');
        });
        
        // Close sidebar when clicking on a nav link on mobile
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('mobile-open');
                }
            });
        });
    }
    
    checkInstallPrompt() {
        if (this.deferredPrompt) {
            this.showInstallButton();
        }
    }
    
    showInstallButton() {
        document.getElementById('installButton').style.display = 'inline-flex';
    }
    
    installApp() {
        if (this.deferredPrompt) {
            this.deferredPrompt.prompt();
            this.deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                } else {
                    console.log('User dismissed the install prompt');
                }
                this.deferredPrompt = null;
            });
        }
    }
    
    hideInstallPrompt() {
        document.getElementById('installPrompt').classList.remove('show');
    }
    
    /**
     * Setup service worker update listener
     */
    setupServiceWorkerUpdateListener() {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.ready.then(registration => {
                // Check for updates every 30 minutes
                setInterval(() => {
                    registration.update();
                }, 30 * 60 * 1000);
                
                // Listen for updates
                registration.addEventListener('updatefound', () => {
                    const newWorker = registration.installing;
                    
                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            // New service worker available
                            this.showUpdateNotification();
                        }
                    });
                });
            });
        }
    }
    
    /**
     * Show update notification
     */
    showUpdateNotification() {
        const updateNotification = document.getElementById('updateNotification');
        updateNotification.style.display = 'flex';
    }
    
    /**
     * Dismiss update notification
     */
    dismissUpdateNotification() {
        const updateNotification = document.getElementById('updateNotification');
        updateNotification.style.display = 'none';
    }
    
    /**
     * Update the app
     */
    updateApp() {
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.ready.then(registration => {
                if (registration.waiting) {
                    // Tell the service worker to skip waiting
                    registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                    
                    // Reload the page once the new service worker is active
                    navigator.serviceWorker.addEventListener('controllerchange', () => {
                        window.location.reload();
                    });
                }
            });
        }
    }
    
    /**
     * Update online/offline status indicator
     */
    updateOnlineStatus() {
        const offlineIndicator = document.getElementById('offlineIndicator');
        if (navigator.onLine) {
            offlineIndicator.classList.remove('show');
        } else {
            offlineIndicator.classList.add('show');
        }
    }
    
    /**
     * Show confirmation dialog
     * @param {string} title - Dialog title
     * @param {string} message - Dialog message
     * @param {Function} onConfirm - Callback function when confirmed
     */
    showConfirmDialog(title, message, onConfirm) {
        const dialog = document.getElementById('confirmDialog');
        const backdrop = document.getElementById('confirmBackdrop');
        const confirmTitle = document.getElementById('confirmTitle');
        const confirmMessage = document.getElementById('confirmMessage');
        const confirmOk = document.getElementById('confirmOk');
        const confirmCancel = document.getElementById('confirmCancel');
        
        confirmTitle.textContent = title;
        confirmMessage.textContent = message;
        
        dialog.classList.add('show');
        backdrop.style.display = 'flex';
        backdrop.classList.add('show');
        document.body.style.overflow = 'hidden';
        
        // Focus on cancel button for safety
        confirmCancel.focus();
        
        // Remove previous event listeners
        const newConfirmOk = confirmOk.cloneNode(true);
        const newConfirmCancel = confirmCancel.cloneNode(true);
        confirmOk.parentNode.replaceChild(newConfirmOk, confirmOk);
        confirmCancel.parentNode.replaceChild(newConfirmCancel, confirmCancel);
        
        // Add new event listeners
        newConfirmOk.addEventListener('click', () => {
            this.hideConfirmDialog();
            onConfirm();
        });
        
        newConfirmCancel.addEventListener('click', () => {
            this.hideConfirmDialog();
        });
        
        // ESC key to cancel
        const escHandler = (e) => {
            if (e.key === 'Escape') {
                this.hideConfirmDialog();
                document.removeEventListener('keydown', escHandler);
            }
        };
        document.addEventListener('keydown', escHandler);
    }
    
    /**
     * Hide confirmation dialog
     */
    hideConfirmDialog() {
        const dialog = document.getElementById('confirmDialog');
        const backdrop = document.getElementById('confirmBackdrop');
        
        dialog.classList.remove('show');
        backdrop.classList.remove('show');
        backdrop.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
    
    /**
     * Trap focus within a modal for accessibility
     * @param {HTMLElement} modal - The modal element
     */
    trapFocus(modal) {
        const focusableElements = modal.querySelectorAll(
            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        );
        
        if (focusableElements.length === 0) return;
        
        const firstFocusable = focusableElements[0];
        const lastFocusable = focusableElements[focusableElements.length - 1];
        
        const handleTabKey = (e) => {
            if (e.key !== 'Tab') return;
            
            if (e.shiftKey) {
                if (document.activeElement === firstFocusable) {
                    e.preventDefault();
                    lastFocusable.focus();
                }
            } else {
                if (document.activeElement === lastFocusable) {
                    e.preventDefault();
                    firstFocusable.focus();
                }
            }
        };
        
        modal.addEventListener('keydown', handleTabKey);
    }
    
    /**
     * Get statistics for the dashboard
     * @returns {Object} - Statistics object
     */
    getStatistics() {
        const currentDate = new Date();
        const currentMonth = currentDate.getMonth();
        const currentYear = currentDate.getFullYear();
        
        return {
            totalClients: this.clients.length,
            totalAppointments: this.appointments.length,
            upcomingAppointments: this.appointments.filter(apt => 
                new Date(apt.date + ' ' + apt.time) > new Date()
            ).length,
            lowStockItems: this.inventory.filter(item => item.quantity <= item.lowStock).length,
            monthRevenue: this.appointments
                .filter(apt => {
                    const aptDate = new Date(apt.date);
                    return aptDate.getMonth() === currentMonth && aptDate.getFullYear() === currentYear;
                })
                .reduce((total, apt) => total + apt.price, 0),
            yearRevenue: this.appointments
                .filter(apt => {
                    const aptDate = new Date(apt.date);
                    return aptDate.getFullYear() === currentYear;
                })
                .reduce((total, apt) => total + apt.price, 0)
        };
    }
    
    /**
     * Format currency value (no symbol, just number)
     * @param {number} value - The value to format
     * @returns {string} - Formatted value
     */
    formatCurrency(value) {
        return value.toFixed(2);
    }
    
    /**
     * Format date for display
     * @param {string} dateString - Date string
     * @returns {string} - Formatted date
     */
    formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString(this.currentLanguage === 'en' ? 'en-US' : 
                                      this.currentLanguage === 'es' ? 'es-ES' : 
                                      this.currentLanguage === 'ru' ? 'ru-RU' : 'he-IL');
    }
    
    /**
     * Request notification permission from user
     * @returns {Promise<string>} - Permission state
     */
    async requestNotificationPermission() {
        if (!('Notification' in window)) {
            console.log('This browser does not support notifications');
            return 'denied';
        }
        
        if (Notification.permission === 'granted') {
            return 'granted';
        }
        
        if (Notification.permission !== 'denied') {
            const permission = await Notification.requestPermission();
            return permission;
        }
        
        return Notification.permission;
    }
    
    /**
     * Schedule notifications for upcoming appointments
     */
    scheduleAppointmentNotifications() {
        if (!this.settings.enablePushNotifications) {
            return;
        }
        
        if (Notification.permission !== 'granted') {
            return;
        }
        
        const now = new Date();
        const upcomingAppointments = this.appointments.filter(apt => {
            const aptDateTime = new Date(apt.date + ' ' + apt.time);
            return aptDateTime > now;
        });
        
        upcomingAppointments.forEach(appointment => {
            const aptDateTime = new Date(appointment.date + ' ' + appointment.time);
            const timeDiff = aptDateTime - now;
            
            // 24 hour notification
            const twentyFourHours = 24 * 60 * 60 * 1000;
            const oneHour = 60 * 60 * 1000;
            
            const client = this.clients.find(c => c.id === appointment.clientId);
            const clientName = client ? client.name : 'Unknown Client';
            
            // Schedule 24-hour notification
            if (timeDiff > twentyFourHours - 5000 && timeDiff < twentyFourHours + 5000) {
                this.showNotification(
                    this.translate('appointment_reminder_24h'),
                    `${clientName} - ${appointment.service}`
                );
            }
            
            // Schedule 1-hour notification
            if (timeDiff > oneHour - 5000 && timeDiff < oneHour + 5000) {
                this.showNotification(
                    this.translate('appointment_reminder_1h'),
                    `${clientName} - ${appointment.service}`
                );
            }
        });
    }
    
    /**
     * Show a browser notification
     * @param {string} title - Notification title
     * @param {string} body - Notification body
     */
    showNotification(title, body) {
        if (Notification.permission === 'granted') {
            const notification = new Notification(title, {
                body: body,
                icon: './icons/icon-192.png',
                badge: './icons/icon-192.png',
                vibrate: [200, 100, 200],
                tag: 'appointment-reminder',
                requireInteraction: true
            });
            
            notification.onclick = () => {
                window.focus();
                this.showSection('upcoming');
                notification.close();
            };
        }
    }
    
    /**
     * Check for notifications periodically
     */
    startNotificationChecker() {
        // Check every minute for upcoming appointments
        setInterval(() => {
            this.scheduleAppointmentNotifications();
        }, 60000); // 1 minute
        
        // Initial check
        this.scheduleAppointmentNotifications();
    }
}

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    window.HairSalonApp = new HairSalonPro();
});

// Service Worker Registration
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('./service-worker.js')
      .then(function(registration) {
        console.log('✅ Service Worker registered with scope:', registration.scope);
      })
      .catch(function(error) {
        console.log('❌ Service Worker registration failed:', error);
      });
  });
}
</script>
</body>
</html>


